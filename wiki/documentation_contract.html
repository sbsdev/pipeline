<!DOCTYPE html>
<html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta charset="utf-8">
    <title>Documentation contract</title>
    <link rel="stylesheet" href="/pipeline/css/main.css">
    <link rel="stylesheet" href="/pipeline/css/coderay.css">
  </head>
  <body>
	<nav id="spine">
	  <ul>
  
    <li>
      
        
          <a href="/pipeline/wiki/Home.html">
        
        Home
        
          </a>
        
      
    </li>
  
    <li>
      
        
          <span class="current">
        
        Documentation contract
        
          </span>
        
      
    </li>
  
</ul>

	</nav>
	<div class="edit-button">
	  <a href="https://github.com/daisy/pipeline/edit/wiki/documentation_contract.md">Edit this page on Github</a>
	</div>
    <h1 id="documentation-contract">Documentation contract</h1>

<ul>
  <li>Documentation must be written in HTML (with file extension <code>.html</code>)
or <a href="http://daringfireball.net/projects/markdown/">Markdown</a> (file extension <code>.md</code>). Other files are allowed but
are considered static and get no special treatment.</li>
  <li>Layout/styling of HTML files is the responsibility of the
author/generator. The final rendering of the HTML file is determined
solely by the HTML itself. The processor only determines the
viewport. No additional CSS is applied.</li>
  <li>Layout/styling of Markdown files is the responsibility of the
processor. This means that the Markdown should ideally not include
any CSS. The rendering may be influenced by using standardised
classes (defined below). Because
<a href="http://daringfireball.net/projects/markdown/syntax#html">Markdown may contain HTML fragments</a>,
HTML that needs the same treatment should be given the extension
<code>.md</code>.</li>
  <li>Documentation may contain metadata defined using <a href="https://www.w3.org/TR/2015/REC-rdfa-core-20150317/">RDFa</a>. A list of
recognised types and properties is defined below.</li>
  <li>Some metadata is automatically inferred if not present as RDFa.
    <ul>
      <li>The <code>dc:title</code> property of a file is set to the string content of
the <code>title</code> element, or if there is no such element, the string
content of the first <code>h1</code>, <code>h2</code>, <code>h3</code>, <code>h4</code>, <code>h5</code> or <code>h6</code> element,
or if there is no such element, the file name without extension.</li>
    </ul>
  </li>
  <li>Processors must handle hyperlinks (anchor elements) according to the
following rules:
    <ul>
      <li>Relative links are adapted when the location of documentation
files relative to each other changes.</li>
      <li>Links are automatically changed when the element has one of the
special classes <code>source</code>, <code>apidoc</code> or <code>userdoc</code>. These classes
match the RDF types <code>dp2:source</code>, <code>dp2:apidoc</code>, <code>dp2:userdoc</code>. If
the resource the original link points to is documented by (via the
property <code>dp2:doc</code>) a resource of the indicated type, that
resource becomes the new target of the link. The same happens if
the original HREF <em>is an alias of</em> (via the <code>dp2:alias</code> property)
a resource that is documented by a resource of the indicated type.</li>
      <li>Whenever a link is changed, any “rel”, “rev” and “property”
attributes on the anchor element are removed in order to not
produce incorrect RDFa metadata.</li>
    </ul>
  </li>
  <li>Documentation files may contain <a href="http://mustache.github.io/mustache.5.html">Mustache</a> tags. A list of
available variables, partials and lambdas is defined below.</li>
</ul>

<h2 id="rdf-grammar">RDF grammar</h2>

<h3 id="pre-defined-prefixes">Pre-defined prefixes</h3>

<ul>
  <li>
<code>rdf</code>: <a href="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</a>
</li>
  <li>
<code>dc</code>: <a href="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</a>
</li>
  <li>
<code>xsd</code>: <a href="http://www.w3.org/2001/XMLSchema#">http://www.w3.org/2001/XMLSchema#</a>
</li>
  <li>
<code>dp2</code>: <a href="http://www.daisy.org/ns/pipeline/">http://www.daisy.org/ns/pipeline/</a>
</li>
</ul>

<h3 id="types">Types</h3>

<ul>
  <li>
<code>dp2:userdoc</code>: Documentation file of type “user documentation”.</li>
  <li>
<code>dp2:apidoc</code>: Documentation file of type “API documentation”,
targeted at developers (e.g. Javadoc).</li>
  <li>
<code>dp2:source</code>: Documentation file that includes source code.</li>
  <li>
<code>dp2:script</code>: XProc file that implements a Pipeline script.</li>
</ul>

<h3 id="properties">Properties</h3>

<ul>
  <li>
<code>dp2:doc</code>: The object (documentation file) documents the subject
(source file).</li>
  <li>
<code>dp2:alias</code>: The object (URI) is an alias of the subject (source
file). This can be used for example to link source files with URIs
defined in the catalog XML.</li>
  <li>
<code>dp2:option</code>: The object (anonymous node) is an option of the
subject (script).</li>
  <li>
<code>dp2:input</code>: The object (anonymous node) is an input port of the
subject (script).</li>
  <li>
<code>dp2:id</code>: The object (string) is the name/ID of the subject (option
or input port).</li>
  <li>
<code>dp2:name</code>: The object (string) is the nice name of the subject
(option or input port).</li>
  <li>
<code>dp2:desc</code>: The object (string) is the description of the subject
(option or input port).</li>
  <li>
<code>dp2:required</code>: The object (boolean) determines whether the subject
(option) is required or not. Defaults to false.</li>
  <li>
<code>dp2:default</code>: The object (string) is the default value of the
subject (option).</li>
  <li>
<code>dp2:sequence</code>: The object (boolean) determines whether the subject
(input port) accepts a sequence of documents or not. Defaults to
false.</li>
</ul>

<h2 id="special-classes">Special classes</h2>

<ul>
  <li>
<code>source</code>, <code>apidoc</code>, <code>userdoc</code>: These classes influence the special
processing of anchor elements (see above).</li>
</ul>

<h2 id="mustache-tags">Mustache tags</h2>

<h3 id="variables">Variables</h3>

<ul>
  <li>
    <p><code>options</code>: The options of a script. This variable is only available
in the context of script documentation. The data is built from
existing RDF metadata and is structured as follows:</p>

    <div class="highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>- <span class="string"><span class="content">option1:</span><span class="content">
    name: 'Option 1'
    desc: '...'
    required: true</span></span>
- <span class="string"><span class="content">option2:</span><span class="content">
    name: 'Option 2'
    required: false
    default: 'foo'</span></span>
- <span class="string"><span class="content">all:</span></span>
  - <span class="string"><span class="content">id: option1</span></span>
    <span class="key">name</span>: <span class="string"><span class="content">'Option 1'</span></span>
    <span class="key">desc</span>: <span class="string"><span class="content">'...'</span></span>
    <span class="key">required</span>: <span class="string"><span class="content">true</span></span>
  - <span class="string"><span class="content">id: option2</span></span>
    <span class="key">name</span>: <span class="string"><span class="content">'Option 2'</span></span>
    <span class="key">required</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">default</span>: <span class="string"><span class="content">'foo'</span></span>
</pre></div>
</div>
    </div>

    <p><code>desc</code> may contain HTML (so you probably want to use the triple
mustache to render it: <code>{{{desc}}}</code>).</p>
  </li>
  <li>
    <p><code>inputs</code>: The input ports of a script. This variable is only
available in the context of script documentation. The data is built
from existing RDF metadata and is structured as follows:</p>

    <div class="highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>- <span class="string"><span class="content">source:</span><span class="content">
    name: 'Source'
    desc: '...'
    sequence: true</span></span>
- <span class="string"><span class="content">all:</span></span>
  - <span class="string"><span class="content">id: source</span></span>
    <span class="key">name</span>: <span class="string"><span class="content">'Source'</span></span>
    <span class="key">desc</span>: <span class="string"><span class="content">'...'</span></span>
    <span class="key">sequence</span>: <span class="string"><span class="content">true</span></span>
</pre></div>
</div>
    </div>

    <p>Here also <code>desc</code> may contain HTML.</p>
  </li>
</ul>

<h3 id="partials">Partials</h3>

<ul>
  <li>
<code>toc</code>: Inserts a table of contents from the existing headings in the
document. What exactly the TOC looks like is up to the processor.</li>
  <li>
<code>synopsis</code>: Inserts an overview of the input ports and options of a
script. This tag is only available in the context of script
documentation. The synopsis is built from existing RDF
metadata. What exactly the synopsis looks like is up to the
processor.</li>
</ul>

<h3 id="lambdas">Lambdas</h3>

<ul>
  <li>
    <p><code>sparql</code>: Evaluates a <a href="https://www.w3.org/TR/2013/REC-sparql11-query-20130321/">SPARQL</a> expression against existing RDF
metadata and for each solution of the query, evaluates a Mustache
expression with the SPARQL variables bound to identically named
Mustache variables. A call might look like this:</p>

    <pre><code>{{#sparql}}
SELECT ?href ?title WHERE {
  []    a        dp2:script ;
        dp2:doc  ?href .
  ?href dc:title ?title ;
        a        dp2:userdoc .
}
ORDER BY ?title
- [{{title}}]({{href}})
{{/sparql}
</code></pre>
  </li>
</ul>


  </body>
</html>
