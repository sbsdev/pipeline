<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec" stylesheet="../../main/resources/xml/xslt/dtbook-to-epub3.xsl" xmlns:dtbook="http://www.daisy.org/z3986/2005/dtbook/"
    xmlns:epub="http://www.idpf.org/2007/ops" xmlns:html="http://www.w3.org/1999/xhtml" xslt-version="2.0">

    <!-- dtbookblocknoimggroup -->
    <!-- no point in testing -->

    <!-- inlineinblock -->
    <!-- no point in testing -->

    <!-- block -->
    <!-- no point in testing -->

    <!-- blocknoimggroup -->
    <!-- no point in testing -->

    <!-- docblockorinline -->
    <!-- no point in testing -->

    <!-- coreattrs -->
    <x:scenario label="on a span element with the coreattrs attributes (id, class, title, xml:space, epub:type)">
        <x:context>
            <dtbook:span id="myid" class="myclass sentence topic-sentence" title="mytitle" xml:space="preserve">TEXT</dtbook:span>
        </x:context>
        <x:expect
            label="all the attributes should be preserved, but any classes matching any of the epub:types defined in either the default, the z3998 or organization-specific vocabularies should be mapped to epub:types instead">
            <html:span id="myid" class="myclass" title="mytitle" xml:space="preserve" epub:type="z3998:sentence topic-sentence">TEXT</html:span>
        </x:expect>
    </x:scenario>

    <!-- i18n -->
    <x:scenario label="on a dtbook element with the i18n attributes (xml:lang, dir)">
        <x:context>
            <dtbook:dtbook xml:lang="en" dir="ltr"/>
        </x:context>
        <x:expect label="the xml:lang attribute should be preserved" test="/*/@xml:lang='en'"/>
        <x:expect label="the dir attribute should be preserved" test="/*/@dir='ltr'"/>
    </x:scenario>

    <!-- showin -->
    <x:scenario label="when processing the showin attribute">
        <x:context>
            <dtbook:p>
                <dtbook:span showin="xxx">xxx</dtbook:span>
                <dtbook:span showin="xxp">xxp</dtbook:span>
                <dtbook:span showin="xlx">xlx</dtbook:span>
                <dtbook:span showin="xlp">xlp</dtbook:span>
                <dtbook:span showin="bxx">bxx</dtbook:span>
                <dtbook:span showin="bxp">bxp</dtbook:span>
                <dtbook:span showin="blx">blx</dtbook:span>
                <dtbook:span showin="blp">blp</dtbook:span>
            </dtbook:p>
        </x:context>
        <x:expect label="the showin attribute should be converted to classes (showin-blp, etc.)">
            <html:p>
                <html:span class="showin-xxx">xxx</html:span>
                <html:span class="showin-xxp">xxp</html:span>
                <html:span class="showin-xlx">xlx</html:span>
                <html:span class="showin-xlp">xlp</html:span>
                <html:span class="showin-bxx">bxx</html:span>
                <html:span class="showin-bxp">bxp</html:span>
                <html:span class="showin-blx">blx</html:span>
                <html:span class="showin-blp">blp</html:span>
            </html:p>
        </x:expect>
    </x:scenario>

    <!-- attrs -->
    <!-- covered by the coreattrs and i18n tests -->

    <!-- attrsrqd -->
    <!-- covered by the coreattrs and i18n tests -->

    <!-- dtbookcontent -->
    <x:scenario label="dtbookcontent (head, book)">
        <x:context>
            <dtbook:dtbook version="2005-3">
                <dtbook:head/>
                <dtbook:book/>
            </dtbook:dtbook>
        </x:context>
        <x:expect label="should be allowed inside the dtbook element">
            <html:html epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#">
                <html:head>...</html:head>
                <html:body>...</html:body>
            </html:html>
        </x:expect>
    </x:scenario>

    <!-- dtbook -->
    <x:scenario label="when processing a dtbook element">
        <x:context>
            <dtbook:dtbook version="2005-3"/>
        </x:context>
        <x:expect label="the dtbook element should be converted into a html element, and the only attribute should be the default epub:prefix attribute">
            <html:html epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#">...</html:html>
        </x:expect>
    </x:scenario>

    <!-- attlist.dtbook -->
    <x:scenario label="on a dtbook element with with a version attribute">
        <x:context>
            <dtbook:dtbook version="2005-3" xml:lang="en"/>
        </x:context>
        <x:expect label="but the version attribute should be removed" test="not(/*/@version)"/>
    </x:scenario>

    <!-- headmisc -->
    <!-- no point in testing headmisc -->

    <!-- head -->
    <x:scenario label="when processing a head element">
        <x:context>
            <dtbook:head/>
        </x:context>
        <x:expect label="the head element should be converted into a head element">
            <html:head>...</html:head>
        </x:expect>
    </x:scenario>

    <!-- attlist.head -->
    <x:scenario label="when processing the head element attributes">
        <x:context>
            <dtbook:head profile="http://www.nlb.no/metadata-profile"/>
        </x:context>
        <x:expect label="the profile attribute should be converted to a link element; and also a dc:source element should be created because there was no dc:Source in the DTBook">
            <html:head>
                <html:meta charset="UTF-8"/>
                <html:title>...</html:title>
                <html:meta name="dc:identifier" content=""/>
                <html:meta name="viewport" content="..."/>
                <html:meta name="nordic:guidelines" content="2015-1"/>
                <html:meta name="dc:source" content="urn:isbn:0"/>
                <html:style type="text/css" xml:space="preserve">...</html:style>
                <html:link rel="profile" href="http://www.nlb.no/metadata-profile"/>
            </html:head>
        </x:expect>
    </x:scenario>

    <!-- link -->
    <x:scenario label="when processing a link element">
        <x:context>
            <dtbook:head>
                <dtbook:link/>
                <dtbook:meta name="dc:Source" content="urn:isbn:1234"/>
            </dtbook:head>
        </x:context>
        <x:expect label="the link element should be converted into a link element">
            <html:head>
                <html:meta charset="UTF-8"/>
                <html:title>...</html:title>
                <html:meta name="dc:identifier" content=""/>
                <html:meta name="viewport" content="..."/>
                <html:meta name="nordic:guidelines" content="2015-1"/>
                <html:link/>
                <html:meta name="dc:source" content="urn:isbn:1234"/>
                <html:style type="text/css" xml:space="preserve">...</html:style>
            </html:head>
        </x:expect>
    </x:scenario>

    <!-- attlist.link -->
    <x:scenario label="when processing the link element attributes">
        <x:context>
            <dtbook:link charset="UTF-8" href="theme.css" hreflang="en" media="print" rel="stylesheet" rev="parent" type="text/css"/>
        </x:context>
        <x:expect label="the charset and rev attributes are dropped; everything else is copied through (href/hreflang/media/rel/type)">
            <html:link href="theme.css" hreflang="en" media="print" rel="stylesheet" type="text/css"/>
        </x:expect>
    </x:scenario>

    <!-- meta -->
    <x:scenario label="when processing a meta element">
        <x:scenario label="where the name attribute is dc:title">
            <x:context>
                <dtbook:meta name="dc:title" content="Title"/>
            </x:context>
            <x:expect label="the element should be discarded"/>
        </x:scenario>
        <x:scenario label="where the name attribute is not dc:title">
            <x:context>
                <dtbook:meta name="name"/>
            </x:context>
            <x:expect label="the meta element should be converted into a meta element">
                <html:meta name="name"/>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.meta -->
    <x:scenario label="when processing the meta element attributes">
        <x:context>
            <dtbook:meta http-equiv="http-equiv" name="name" content="content" scheme="scheme"/>
        </x:context>
        <x:expect label="the http-equiv, name and content attributes should be copied but the scheme attribute should be dropped">
            <html:meta http-equiv="http-equiv" name="name" content="content"/>
        </x:expect>
    </x:scenario>

    <!-- book -->
    <x:scenario label="when processing a book element">
        <x:context>
            <dtbook:book/>
        </x:context>
        <x:expect label="the book element should be converted into a body element">
            <html:body>...</html:body>
        </x:expect>
    </x:scenario>

    <!-- attlist.book -->
    <!-- covered by attrs -->

    <!-- frontmatter -->
    <x:scenario label="when processing a frontmatter element">
        <x:scenario label="with both a cover, a titlepage and other content">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <!-- COMMENT #1 -->
                        <dtbook:level1 class="cover"/>
                        <!-- COMMENT #2 -->
                        <dtbook:level1 class="titlepage"/>
                        <!-- COMMENT #3 -->
                        <dtbook:level1/>
                        <!-- COMMENT #4 -->
                        <dtbook:level1/>
                        <!-- COMMENT #5 -->
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the top-level frontmatter levels should become sections and given the appropriate epub:types">
                <html:body>
                    <!-- COMMENT #1 -->
                    <html:section id="..." epub:type="cover"/>
                    <!-- COMMENT #2 -->
                    <html:section id="..." epub:type="frontmatter titlepage"/>
                    <!-- COMMENT #3 -->
                    <html:section id="..." epub:type="frontmatter"/>
                    <!-- COMMENT #4 -->
                    <html:section id="..." epub:type="frontmatter"/>
                    <!-- COMMENT #5 -->
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a cover but not a titlepage, and then other content">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <!-- COMMENT #1 -->
                        <dtbook:level1 class="cover"/>
                        <!-- COMMENT #3 -->
                        <dtbook:level1/>
                        <!-- COMMENT #4 -->
                        <dtbook:level1/>
                        <!-- COMMENT #5 -->
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the top-level frontmatter levels should become sections and given the appropriate epub:types">
                <html:body>
                    <!-- COMMENT #1 -->
                    <html:section id="..." epub:type="cover"/>
                    <!-- COMMENT #3 -->
                    <html:section id="..." epub:type="frontmatter"/>
                    <!-- COMMENT #4 -->
                    <html:section id="..." epub:type="frontmatter"/>
                    <!-- COMMENT #5 -->
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a titlepage but not a cover, and then other content">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <!-- COMMENT #2 -->
                        <dtbook:level1 class="titlepage"/>
                        <!-- COMMENT #3 -->
                        <dtbook:level1/>
                        <!-- COMMENT #4 -->
                        <dtbook:level1/>
                        <!-- COMMENT #5 -->
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the top-level frontmatter levels should become sections and given the appropriate epub:types">
                <html:body>
                    <!-- COMMENT #2 -->
                    <html:section id="..." epub:type="frontmatter titlepage"/>
                    <!-- COMMENT #3 -->
                    <html:section id="..." epub:type="frontmatter"/>
                    <!-- COMMENT #4 -->
                    <html:section id="..." epub:type="frontmatter"/>
                    <!-- COMMENT #5 -->
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a jacketcopy class instead of a cover class">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:level1 class="jacketcopy"/>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the result should be a cover">
                <html:body>
                    <html:section id="..." epub:type="cover"/>
                </html:body>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.frontmatter -->
    <!-- the frontmatter element is unwrapped. see level1 for any inherited id and class values. -->

    <!-- bodymatter -->
    <x:scenario label="when processing a bodymatter element">
        <x:context>
            <dtbook:book>
                <dtbook:bodymatter>
                    <!-- COMMENT #1 -->
                    <dtbook:level1/>
                    <!-- COMMENT #2 -->
                    <dtbook:level1/>
                    <!-- COMMENT #3 -->
                </dtbook:bodymatter>
            </dtbook:book>
        </x:context>
        <x:expect label="the top-level bodymatter levels should become sections and given the appropriate epub:types">
            <html:body>
                <!-- COMMENT #1 -->
                <html:section id="..." epub:type="bodymatter chapter"/>
                <!-- COMMENT #2 -->
                <html:section id="..." epub:type="bodymatter chapter"/>
                <!-- COMMENT #3 -->
            </html:body>
        </x:expect>
    </x:scenario>

    <!-- attlist.bodymatter -->
    <!-- the bodymatter element is unwrapped. see level1 for any inherited id and class values. -->

    <!-- rearmatter -->
    <x:scenario label="when processing a rearmatter element">
        <x:context>
            <dtbook:book>
                <dtbook:rearmatter>
                    <!-- COMMENT #1 -->
                    <dtbook:level1/>
                    <!-- COMMENT #2 -->
                    <dtbook:level1/>
                    <!-- COMMENT #3 -->
                </dtbook:rearmatter>
            </dtbook:book>
        </x:context>
        <x:expect label="the top-level rearmatter levels should become sections and given the appropriate epub:types">
            <html:body>
                <!-- COMMENT #1 -->
                <html:section id="..." epub:type="backmatter"/>
                <!-- COMMENT #2 -->
                <html:section id="..." epub:type="backmatter"/>
                <!-- COMMENT #3 -->
            </html:body>
        </x:expect>
    </x:scenario>

    <!-- attlist.rearmatter -->
    <!-- the rearmatter element is unwrapped. see level1 for any inherited id and class values. -->

    <!-- level -->
    <x:scenario label="when processing a level element">
        <x:scenario label="which has bodymatter as parent">
            <x:context>
                <dtbook:bodymatter>
                    <dtbook:level/>
                </dtbook:bodymatter>
            </x:context>
            <x:expect label="the resulting element should be a section with epub:type='bodymatter'">
                <html:section id="..." epub:type="bodymatter chapter"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="which has another level as parent">
            <x:context>
                <dtbook:bodymatter>
                    <dtbook:level>
                        <dtbook:level/>
                    </dtbook:level>
                </dtbook:bodymatter>
            </x:context>
            <x:expect label="the resulting element should be a section with no implicit epub:type">
                <html:section id="..." epub:type="bodymatter chapter">
                    <html:section id="..."/>
                </html:section>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.level -->
    <!-- tested in level element test -->

    <!-- titlepage -->
    <!-- titlepage is tested in the frontmatter tests. see also the doctitle and docauthor tests. -->

    <!-- level1 -->
    <x:scenario label="when processing a level1 element (in bodymatter)">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1/>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a section with epub:type='bodymatter'">
            <html:section id="..." epub:type="bodymatter chapter"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.level1 -->
    <!-- implicit epub:type tested in the level1 test, "attrs" not necessary to test -->

    <!-- level2 -->
    <x:scenario label="when processing a level2 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:level2/>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a section with no implicit epub:types">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:section id="..."/>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.level2 -->
    <!-- implicit epub:type tested in the level2 test, "attrs" not necessary to test -->

    <!-- level3 -->
    <x:scenario label="when processing a level3 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:level2>
                        <dtbook:level3/>
                    </dtbook:level2>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a section with no implicit epub:types">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:section id="...">
                    <html:section id="..."/>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.level3 -->
    <!-- implicit epub:type tested in the level3 test, "attrs" not necessary to test -->

    <!-- level4 -->
    <x:scenario label="when processing a level4 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:level2>
                        <dtbook:level3>
                            <dtbook:level4/>
                        </dtbook:level3>
                    </dtbook:level2>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a section with no implicit epub:types">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:section id="...">
                    <html:section id="...">
                        <html:section id="..."/>
                    </html:section>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.level4 -->
    <!-- implicit epub:type tested in the level4 test, "attrs" not necessary to test -->

    <!-- level5 -->
    <x:scenario label="when processing a level5 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:level2>
                        <dtbook:level3>
                            <dtbook:level4>
                                <dtbook:level5/>
                            </dtbook:level4>
                        </dtbook:level3>
                    </dtbook:level2>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a section with no implicit epub:types">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:section id="...">
                    <html:section id="...">
                        <html:section id="...">
                            <html:section id="..."/>
                        </html:section>
                    </html:section>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.level5 -->
    <!-- implicit epub:type tested in the level5 test, "attrs" not necessary to test -->

    <!-- level6 -->
    <x:scenario label="when processing a level6 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:level2>
                        <dtbook:level3>
                            <dtbook:level4>
                                <dtbook:level5>
                                    <dtbook:level6/>
                                </dtbook:level5>
                            </dtbook:level4>
                        </dtbook:level3>
                    </dtbook:level2>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a section with no implicit epub:types">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:section id="...">
                    <html:section id="...">
                        <html:section id="...">
                            <html:section id="...">
                                <html:section id="..."/>
                            </html:section>
                        </html:section>
                    </html:section>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.level6 -->
    <!-- implicit epub:type tested in the level6 test, "attrs" not necessary to test -->

    <!-- phrase -->
    <!-- no testing needed? -->

    <!-- special -->
    <!-- no testing needed? -->

    <!-- specialnoa -->
    <!-- no testing needed? -->

    <!-- dtbookinline -->
    <!-- no testing needed? -->

    <!-- inline -->
    <!-- no testing needed? -->

    <!-- inlinenoa -->
    <!-- no testing needed? -->

    <!-- inlines -->
    <!-- no testing needed? -->

    <!-- inlinew -->
    <!-- no testing needed? -->

    <!-- inlinenopagenum -->
    <!-- no testing needed? -->

    <!-- inlinenoprodnote -->
    <!-- no testing needed? -->

    <!-- flow -->
    <!-- no testing needed? -->

    <!-- flownopagenum -->
    <!-- no testing needed? -->

    <!-- br -->
    <x:scenario label="when processing a br element">
        <x:context>
            <dtbook:br/>
        </x:context>
        <x:expect label="the resulting element should be a br element">
            <html:br/>
        </x:expect>
    </x:scenario>

    <!-- attlist.br -->
    <!-- test not needed (coreattrs) -->

    <!-- line -->
    <x:scenario label="when processing a line element">
        <x:context>
            <dtbook:line/>
        </x:context>
        <x:expect label="the resulting element should be a p element with an added line class">
            <html:p class="line"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.line -->
    <!-- implicit class tested in element test, otherwise nothing interesting to test -->

    <!-- linenum -->
    <x:scenario label="when processing a linenum element">
        <x:context>
            <dtbook:linenum/>
        </x:context>
        <x:expect label="the resulting element should be a span element with an added linenum class">
            <html:span class="linenum"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.linenum -->
    <!-- implicit class tested in element test, otherwise nothing interesting to test -->

    <!-- address -->
    <x:scenario label="when processing a address element">
        <x:context>
            <dtbook:address/>
        </x:context>
        <x:expect label="the resulting element should be a address element">
            <html:address id="..."/>
        </x:expect>
    </x:scenario>

    <!-- attlist.address -->
    <!-- nothing interesting to test -->

    <!-- div -->
    <x:scenario label="when processing a div element">
        <x:context>
            <dtbook:div/>
        </x:context>
        <x:expect label="the resulting element should be a div element">
            <html:div/>
        </x:expect>
    </x:scenario>

    <!-- attlist.div -->
    <!-- nothing interesting to test -->

    <!-- title -->
    <x:scenario label="when processing a title element">
        <x:context>
            <dtbook:title/>
        </x:context>
        <x:expect label="the resulting element should be a strong element with an added title class">
            <html:strong class="title"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.title -->
    <!-- implicit class tested in element test, otherwise nothing interesting to test -->

    <!-- author -->
    <x:scenario label="when processing a author element">
        <x:context>
            <dtbook:author/>
        </x:context>
        <x:expect label="the resulting element should be a span element with an added epub:type of z3998:author">
            <html:span epub:type="z3998:author"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.author -->
    <!-- implicit epub:type tested in element test, otherwise nothing interesting to test -->

    <!-- prodnote -->
    <x:scenario label="when processing a prodnote element">
        <x:scenario label="which is not a top-level element on the cover page">
            <x:context>
                <dtbook:prodnote/>
            </x:context>
            <x:expect label="the resulting element should be a aside element with an added epub:type of z3998:production">
                <html:aside id="..." epub:type="z3998:production" class="prodnote"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="which is a top-level element on the cover page">
            <x:context>
                <dtbook:frontmatter>
                    <dtbook:level1 class="cover">
                        <dtbook:prodnote/>
                    </dtbook:level1>
                    <dtbook:level1 class="jacketcopy">
                        <dtbook:prodnote/>
                    </dtbook:level1>
                </dtbook:frontmatter>
            </x:context>
            <x:expect label="the resulting element should be a section element with an added epub:type of z3998:production">
                <html:section epub:type="cover" id="...">
                    <html:section id="..."/>
                </html:section>
                <html:section epub:type="cover" id="...">
                    <html:section id="..."/>
                </html:section>
            </x:expect>
        </x:scenario>
        <x:scenario label="which is a div inside one of the cover parts">
            <x:context>
                <dtbook:frontmatter>
                    <dtbook:level1 class="jacketcopy">
                        <dtbook:prodnote class="frontcover" render="optional">
                            <dtbook:div class="render-optional production"/>
                        </dtbook:prodnote>
                    </dtbook:level1>
                </dtbook:frontmatter>
            </x:context>
            <x:expect label="the resulting element should be a prodnote">
                <html:section epub:type="cover" id="...">
                    <html:section class="render-optional frontcover" id="...">
                        <html:aside epub:type="z3998:production" class="prodnote render-optional" id="..."/>
                    </html:section>
                </html:section>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.prodnote -->
    <x:scenario label="when processing the prodnote element attributes">
        <x:context>
            <dtbook:imggroup>
                <dtbook:prodnote id="prodnote" imgref="img1 img2" render="optional"/>
                <dtbook:img id="img1" src="img.jpg"/>
                <dtbook:img id="img2" src="img.jpg"/>
            </dtbook:imggroup>
        </x:context>
        <x:expect label="the render should become a class and imgref is replaced by the longdesc attribute on the corresponding img element.">
            <html:figure id="..." class="image-series">
                <html:aside id="prodnote" epub:type="z3998:production" class="prodnote render-optional"/>
                <html:figure class="image">
                    <html:img id="img1" src="images/img.jpg" longdesc="#prodnote" alt="image"/>
                </html:figure>
                <html:figure class="image">
                    <html:img id="img2" src="images/img.jpg" longdesc="#prodnote" alt="image"/>
                </html:figure>
            </html:figure>
        </x:expect>
    </x:scenario>

    <!-- sidebar -->
    <x:scenario label="when processing a sidebar element">
        <x:scenario label="with no attributes">
            <x:context>
                <dtbook:sidebar/>
            </x:context>
            <x:expect label="the resulting element should be a aside with an added epub:type of sidebar">
                <html:aside id="..." epub:type="sidebar" class="sidebar"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="with render=optional">
            <x:context>
                <dtbook:sidebar render="optional"/>
            </x:context>
            <x:expect label="the resulting element should be a aside with an added epub:type of sidebar">
                <html:aside id="..." epub:type="sidebar" class="sidebar"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="with render=required">
            <x:context>
                <dtbook:sidebar render="required"/>
            </x:context>
            <x:expect label="the resulting element should be a aside with an added epub:type of sidebar">
                <html:figure id="..." epub:type="sidebar" class="sidebar"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a hd element">
            <x:context>
                <dtbook:sidebar>
                    <dtbook:hd>Headline</dtbook:hd>
                </dtbook:sidebar>
            </x:context>
            <x:expect label="the hd element should become a headline">
                <html:aside id="..." epub:type="sidebar" class="sidebar">
                    <html:h1 id="...">Headline</html:h1>
                </html:aside>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.sidebar -->
    <!-- implicit epub:type tested in element test, otherwise nothing interesting to test -->

    <!-- note -->
    <x:scenario label="when processing a note element">
        <x:context>
            <dtbook:note/>
        </x:context>
        <x:expect label="the resulting element should by default be an aside with an added epub:type of note">
            <html:aside id="..." epub:type="note" class="notebody"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.note -->
    <!-- implicit epub:type tested in element test, otherwise nothing interesting to test -->

    <!-- annotation -->
    <x:scenario label="when processing a annotation element">
        <x:context>
            <dtbook:annotation/>
        </x:context>
        <x:expect label="the resulting element should be a aside with an added epub:type of annotation">
            <html:aside id="..." epub:type="annotation" class="annotation"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.annotation -->
    <!-- implicit epub:type tested in element test, otherwise nothing interesting to test -->

    <!-- epigraph -->
    <x:scenario label="when processing a epigraph element">
        <x:context>
            <dtbook:epigraph/>
        </x:context>
        <x:expect label="the resulting element should be a p with an added epub:type of epigraph">
            <html:p id="..." epub:type="epigraph" class="epigraph"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.epigraph -->
    <!-- implicit epub:type tested in element test, otherwise nothing interesting to test -->

    <!-- byline -->
    <x:scenario label="when processing a byline element">
        <x:context>
            <dtbook:byline/>
        </x:context>
        <x:expect label="the resulting element should be a span with an added class of byline">
            <html:span id="..." class="byline"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.byline -->
    <!-- implicit class tested in element test, otherwise nothing interesting to test -->

    <!-- dateline -->
    <x:scenario label="when processing a dateline element">
        <x:context>
            <dtbook:dateline/>
        </x:context>
        <x:expect label="the resulting element should be a span with an added class of dateline">
            <html:span id="..." class="dateline"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.dateline -->
    <!-- implicit class tested in element test, otherwise nothing interesting to test -->

    <!-- linegroup -->
    <x:scenario label="when processing a linegroup element">
        <x:scenario label="which contains a hd element">
            <x:context>
                <dtbook:bodymatter>
                    <dtbook:level>
                        <dtbook:hd>Headline 1</dtbook:hd>
                        <dtbook:linegroup>
                            <dtbook:hd>Headline 2</dtbook:hd>
                        </dtbook:linegroup>
                    </dtbook:level>
                </dtbook:bodymatter>
            </x:context>
            <x:expect label="the resulting element should be a section with an added class of linegroup">
                <html:section id="..." epub:type="bodymatter chapter">
                    <html:h1 id="...">Headline 1</html:h1>
                    <html:section id="..." class="linegroup">
                        <html:h2 id="...">Headline 2</html:h2>
                    </html:section>
                </html:section>
            </x:expect>
        </x:scenario>
        <x:scenario label="which does not contain a hd element">
            <x:context>
                <dtbook:linegroup/>
            </x:context>
            <x:expect label="the resulting element should be a div with an added class of linegroup">
                <html:div id="..." class="linegroup"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="which has a poem element as parent">
            <x:context>
                <dtbook:poem>
                    <dtbook:linegroup/>
                </dtbook:poem>
            </x:context>
            <x:expect label="the resulting element should be given an added epub:type of z3998:verse">
                <html:section id="..." epub:type="z3998:poem" class="poem">
                    <html:div id="..." class="linegroup" epub:type="z3998:verse"/>
                </html:section>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.linegroup -->
    <!-- implicit class and epub:type tested in element test, otherwise nothing interesting to test -->

    <!-- poem -->
    <x:scenario label="when processing a poem element">
        <x:scenario label="which contains a hd element">
            <x:context>
                <dtbook:bodymatter>
                    <dtbook:level>
                        <dtbook:hd>Headline 1</dtbook:hd>
                        <dtbook:poem>
                            <dtbook:hd>Headline 2</dtbook:hd>
                        </dtbook:poem>
                    </dtbook:level>
                </dtbook:bodymatter>
            </x:context>
            <x:expect label="the resulting element should be a section with an added epub:type of z3998:poem">
                <html:section id="..." epub:type="bodymatter chapter">
                    <html:h1 id="...">Headline 1</html:h1>
                    <html:section id="..." epub:type="z3998:poem" class="poem">
                        <html:h2 id="...">Headline 2</html:h2>
                    </html:section>
                </html:section>
            </x:expect>
        </x:scenario>
        <x:scenario label="which does not contain a hd element">
            <x:context>
                <dtbook:poem/>
            </x:context>
            <x:expect label="the resulting element should also be a section with an added epub:type of z3998:poem">
                <html:section id="..." epub:type="z3998:poem" class="poem"/>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.poem -->
    <!-- implicit epub:type tested in element test, otherwise nothing interesting to test -->

    <!-- a -->
    <x:scenario label="when processing a a element">
        <x:context>
            <dtbook:a>TEXT</dtbook:a>
        </x:context>
        <x:expect label="the resulting element should be a a">
            <html:a id="...">TEXT</html:a>
        </x:expect>
    </x:scenario>

    <!-- attlist.a -->
    <x:scenario label="when processing the a element attributes">
        <x:context>
            <dtbook:a class="myclass" external="true" type="text/plain" href="http://example.net/LICENSE.txt" hreflang="en" rel="license" rev="chapter" accesskey="x" tabindex="-1">TEXT</dtbook:a>
        </x:context>
        <x:expect label="the external and rev attributes are converted to classes, the external may also imply a target _blank, and the rest of the attributes are copied over as is">
            <html:a id="..." class="external-true rev-chapter myclass" target="_blank" type="text/plain" href="http://example.net/LICENSE.txt" hreflang="en" rel="license" accesskey="x" tabindex="-1"
                >TEXT</html:a>
        </x:expect>
    </x:scenario>

    <!-- em -->
    <x:scenario label="when processing a em element">
        <x:context>
            <dtbook:em>TEXT</dtbook:em>
        </x:context>
        <x:expect label="the resulting element should be a em">
            <html:em>TEXT</html:em>
        </x:expect>
    </x:scenario>

    <!-- attlist.em -->
    <!-- nothing interesting to test -->

    <!-- strong -->
    <x:scenario label="when processing a strong element">
        <x:context>
            <dtbook:strong>TEXT</dtbook:strong>
        </x:context>
        <x:expect label="the resulting element should be a strong">
            <html:strong>TEXT</html:strong>
        </x:expect>
    </x:scenario>

    <!-- attlist.strong -->
    <!-- nothing interesting to test -->

    <!-- dfn -->
    <x:scenario label="when processing a dfn element">
        <x:context>
            <dtbook:dfn>TEXT</dtbook:dfn>
        </x:context>
        <x:expect label="the resulting element should be a dfn">
            <html:dfn>TEXT</html:dfn>
        </x:expect>
    </x:scenario>

    <!-- attlist.dfn -->
    <!-- nothing interesting to test -->

    <!-- kbd -->
    <x:scenario label="when processing a kbd element">
        <x:context>
            <dtbook:kbd>TEXT</dtbook:kbd>
        </x:context>
        <x:expect label="the resulting element should be a kbd">
            <html:kbd>TEXT</html:kbd>
        </x:expect>
    </x:scenario>

    <!-- attlist.kbd -->
    <!-- nothing interesting to test -->

    <!-- code -->
    <x:scenario label="when processing a code element">
        <x:context>
            <dtbook:code>TEXT</dtbook:code>
        </x:context>
        <x:expect label="the resulting element should be a code">
            <html:code>TEXT</html:code>
        </x:expect>
    </x:scenario>

    <!-- attlist.code -->
    <x:scenario label="when processing the code element attributes">
        <x:context>
            <dtbook:code smilref="#" xml:space="preserve">TEXT</dtbook:code>
        </x:context>
        <x:expect label="the smilref and xml:space attributes should be dropped">
            <html:code>TEXT</html:code>
        </x:expect>
    </x:scenario>

    <!-- samp -->
    <x:scenario label="when processing a samp element">
        <x:context>
            <dtbook:samp>TEXT</dtbook:samp>
        </x:context>
        <x:expect label="the resulting element should be a samp">
            <html:samp>TEXT</html:samp>
        </x:expect>
    </x:scenario>

    <!-- attlist.samp -->
    <x:scenario label="when processing the samp element attributes">
        <x:context>
            <dtbook:samp smilref="#">TEXT</dtbook:samp>
        </x:context>
        <x:expect label="the smilref attribute should be dropped">
            <html:samp>TEXT</html:samp>
        </x:expect>
    </x:scenario>

    <!-- cite -->
    <x:scenario label="when processing a cite element">
        <x:context>
            <dtbook:cite>TEXT</dtbook:cite>
        </x:context>
        <x:expect label="the resulting element should be a cite">
            <html:cite>TEXT</html:cite>
        </x:expect>
    </x:scenario>

    <!-- attlist.cite -->
    <!-- nothing interesting to test -->

    <!-- abbr -->
    <x:scenario label="when processing a abbr element">
        <x:context>
            <dtbook:abbr>TEXT</dtbook:abbr>
        </x:context>
        <x:expect label="the resulting element should be a abbr">
            <html:abbr>TEXT</html:abbr>
        </x:expect>
    </x:scenario>

    <!-- attlist.abbr -->
    <!-- nothing interesting to test -->

    <!-- acronym -->
    <x:scenario label="when processing a acronym element">
        <x:context>
            <dtbook:acronym/>
        </x:context>
        <x:expect label="the resulting element should be a abbr with an added epub:type of z3998:acronym">
            <html:abbr epub:type="z3998:acronym"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.acronym -->
    <x:scenario label="when processing the acronym element attributes">
        <x:scenario label="with pronounce='no'">
            <x:context>
                <dtbook:acronym pronounce="no"/>
            </x:context>
            <x:expect
                label="the pronounce attribute should be replaced with epub:type='z3998:initialism' and class='initialism'. The class is used for CSS-rule: initialism{ -epub-speak-as:spell-out; }">
                <html:abbr class="initialism" epub:type="z3998:initialism"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="with pronounce='yes'">
            <x:context>
                <dtbook:acronym pronounce="yes"/>
            </x:context>
            <x:expect label="the pronounce attribute should be replaced with epub:type='z3998:acronym'">
                <html:abbr epub:type="z3998:acronym"/>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- sub -->
    <x:scenario label="when processing a sub element">
        <x:context>
            <dtbook:sub>TEXT</dtbook:sub>
        </x:context>
        <x:expect label="the resulting element should be a sub">
            <html:sub>TEXT</html:sub>
        </x:expect>
    </x:scenario>

    <!-- attlist.sub -->
    <!-- nothing interesting to test -->

    <!-- sup -->
    <x:scenario label="when processing a sup element">
        <x:context>
            <dtbook:sup>TEXT</dtbook:sup>
        </x:context>
        <x:expect label="the resulting element should be a sup">
            <html:sup>TEXT</html:sup>
        </x:expect>
    </x:scenario>

    <!-- attlist.sup -->
    <!-- nothing interesting to test -->

    <!-- span -->
    <x:scenario label="when processing a span element">
        <x:context>
            <dtbook:span>TEXT</dtbook:span>
        </x:context>
        <x:expect label="the resulting element should be a span">
            <html:span>TEXT</html:span>
        </x:expect>
    </x:scenario>

    <!-- attlist.span -->
    <!-- nothing interesting to test -->

    <!-- bdo -->
    <x:scenario label="when processing a bdo element">
        <x:context>
            <dtbook:bdo>TEXT</dtbook:bdo>
        </x:context>
        <x:expect label="the resulting element should be a bdo">
            <html:bdo>TEXT</html:bdo>
        </x:expect>
    </x:scenario>

    <!-- attlist.bdo -->
    <x:scenario label="when processing the bdo element attributes">
        <x:context>
            <dtbook:bdo smilref="#">TEXT</dtbook:bdo>
        </x:context>
        <x:expect label="the smilref attribute should be dropped">
            <html:bdo>TEXT</html:bdo>
        </x:expect>
    </x:scenario>

    <!-- sent -->
    <x:scenario label="when processing a sent element">
        <x:context>
            <dtbook:sent>TEXT</dtbook:sent>
        </x:context>
        <x:expect label="the resulting element should be a span with an added epub:type of z3998:sentence">
            <html:span epub:type="z3998:sentence" class="sentence">TEXT</html:span>
        </x:expect>
    </x:scenario>

    <!-- attlist.sent -->
    <!-- implicit epub:type tested in element test, otherwise nothing interesting to test -->

    <!-- w -->
    <x:scenario label="when processing a w element">
        <x:context>
            <dtbook:w>TEXT</dtbook:w>
        </x:context>
        <x:expect label="the resulting element should be a span with an added epub:type of z3998:word">
            <html:span epub:type="z3998:word" class="word">TEXT</html:span>
        </x:expect>
    </x:scenario>

    <!-- attlist.w -->
    <!-- implicit epub:type tested in element test, otherwise nothing interesting to test -->

    <!-- pagenum -->
    <x:scenario label="when processing a pagenum element">
        <x:scenario label="with numeric values">
            <x:context>
                <dtbook:div>
                    <dtbook:pagenum>1</dtbook:pagenum>
                    <dtbook:p>
                        <dtbook:pagenum>2</dtbook:pagenum>
                    </dtbook:p>
                </dtbook:div>
            </x:context>
            <x:expect
                label="the resulting element should be a span for inline contexts or a div otherwise. An epub:type of pagebreak should be added, the page attribute should be converted into a class and the contents of the element moved into its title attribute">
                <html:div>
                    <html:div class="page-normal" epub:type="pagebreak" title="1"/>
                    <html:p>
                        <html:span class="page-normal" epub:type="pagebreak" title="2"/>
                    </html:p>
                </html:div>
            </x:expect>
        </x:scenario>
        <x:scenario label="with missing page numbers">
            <x:context>
                <dtbook:div>
                    <dtbook:pagenum id="unnumbered"/>
                </dtbook:div>
            </x:context>
            <x:expect label="unnumbered pages should not have a title attribute, and should use the page-special class">
                <html:div>
                    <html:div id="unnumbered" class="page-special" epub:type="pagebreak"/>
                </html:div>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.pagenum -->
    <x:scenario label="when processing the pagenum element attributes">
        <x:context>
            <dtbook:span>
                <dtbook:pagenum title="old title" page="special">2</dtbook:pagenum>
            </dtbook:span>
        </x:context>
        <x:expect label="the title attribute should be overwritten by the text node child of pagenum, the page attribute should be converted to a class">
            <html:span>
                <html:span class="page-special" epub:type="pagebreak" title="2"/>
            </html:span>
        </x:expect>
    </x:scenario>

    <!-- noteref -->
    <x:scenario label="when processing a noteref element">
        <x:context>
            <dtbook:noteref idref="#target">TEXT</dtbook:noteref>
        </x:context>
        <x:expect label="the resulting element should be a a">
            <html:a id="..." epub:type="noteref" class="noteref" href="#target">TEXT</html:a>
        </x:expect>
    </x:scenario>

    <!-- attlist.noteref -->
    <x:scenario label="when processing the noteref element attributes">
        <x:context>
            <dtbook:noteref idref="#target" type="image/png">TEXT</dtbook:noteref>
        </x:context>
        <x:expect label="the type attribute should be copied when present">
            <html:a id="..." epub:type="noteref" class="noteref" href="#target" type="image/png">TEXT</html:a>
        </x:expect>
    </x:scenario>

    <!-- annoref -->
    <x:scenario label="when processing a annoref element">
        <x:context>
            <dtbook:annoref idref="#target">TEXT</dtbook:annoref>
        </x:context>
        <x:expect label="the resulting element should be a a">
            <html:a id="..." epub:type="annoref" class="annoref" href="#target">TEXT</html:a>
        </x:expect>
    </x:scenario>

    <!-- attlist.annoref -->
    <x:scenario label="when processing the annoref element attributes">
        <x:context>
            <dtbook:annoref idref="#target" type="image/png">TEXT</dtbook:annoref>
        </x:context>
        <x:expect label="the type attribute should be copied when present">
            <html:a id="..." epub:type="annoref" class="annoref" href="#target" type="image/png">TEXT</html:a>
        </x:expect>
    </x:scenario>

    <!-- q -->
    <x:scenario label="when processing a q element">
        <x:context>
            <dtbook:q>TEXT</dtbook:q>
        </x:context>
        <x:expect label="the resulting element should be a q">
            <html:q id="...">TEXT</html:q>
        </x:expect>
    </x:scenario>

    <!-- attlist.q -->
    <x:scenario label="when processing the q element attributes">
        <x:context>
            <dtbook:q cite="#target">TEXT</dtbook:q>
        </x:context>
        <x:expect label="the cite attribute should be copied when present">
            <html:q id="..." cite="#target">TEXT</html:q>
        </x:expect>
    </x:scenario>

    <!-- Length -->
    <!-- no point in testing -->

    <!-- MultiLength -->
    <!-- no point in testing -->

    <!-- Pixels -->
    <!-- no point in testing -->

    <!-- img -->
    <x:scenario label="when processing a img element">
        <x:context>
            <dtbook:img src="img.jpg"/>
        </x:context>
        <x:expect label="the resulting element should be a img">
            <html:img src="images/img.jpg" id="..." alt="image"/>
        </x:expect>
    </x:scenario>

    <!-- attlist.img -->
    <x:scenario label="when processing the img element attributes">
        <x:context>
            <dtbook:img src="img.jpg#target" alt="alt text" longdesc="#image-description" height="100" width="100" id="id"/>
        </x:context>
        <x:expect label="the resulting element should be a img">
            <html:img src="images/img.jpg#target" alt="alt text" longdesc="#image-description" height="100" width="100" id="id"/>
        </x:expect>
    </x:scenario>

    <!-- imggroup -->
    <x:scenario label="when processing a imggroup element">
        <x:scenario label="without any children">
            <x:context>
                <dtbook:imggroup/>
            </x:context>
            <x:expect label="the resulting element should be a figure">
                <html:figure id="..." class="..."/>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a single img child [prodnote, img, pagenum, caption]">
            <x:context>
                <dtbook:imggroup>
                    <dtbook:prodnote id="prodnote1" imgref="img1"/>
                    <dtbook:img src="img.jpg" id="img1"/>
                    <dtbook:pagenum>1</dtbook:pagenum>
                    <dtbook:caption id="caption1"/>
                </dtbook:imggroup>
            </x:context>
            <x:expect label="the resulting element should be a figure with class='image'">
                <html:figure id="..." class="image">
                    <html:img src="images/img.jpg" id="img1" longdesc="#prodnote1" alt="image"/>
                    <html:aside id="prodnote1" epub:type="z3998:production" class="prodnote"/>
                    <html:div epub:type="pagebreak" class="page-normal" title="1"/>
                    <html:figcaption id="caption1"/>
                </html:figure>
            </x:expect>
        </x:scenario>
        <x:scenario label="with multiple img children [img, prodnote, caption, img, caption, prodnote, caption, img, img, caption, img]">
            <x:context>
                <dtbook:imggroup>
                    <dtbook:img src="img.jpg" id="img1"/>
                    <dtbook:prodnote id="prodnote1" imgref="img1"/>
                    <dtbook:caption id="caption1">
                        <dtbook:p/>
                    </dtbook:caption>
                    <dtbook:img src="img.jpg" id="img2"/>
                    <dtbook:caption id="caption2">
                        <dtbook:p/>
                    </dtbook:caption>
                    <dtbook:prodnote id="prodnote2" imgref="img2"/>
                    <dtbook:caption id="caption3">
                        <dtbook:p/>
                    </dtbook:caption>
                    <dtbook:img src="img.jpg" id="img3"/>
                    <dtbook:img src="img.jpg" id="img4"/>
                    <dtbook:caption id="caption4">
                        <dtbook:p/>
                    </dtbook:caption>
                    <dtbook:img src="img.jpg" id="img5"/>
                </dtbook:imggroup>
            </x:context>
            <x:expect label="the resulting element should be a figure with class='image-series'">
                <html:figure id="..." class="image-series">
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img1" longdesc="#prodnote1" alt="image"/>
                        <html:aside id="prodnote1" epub:type="z3998:production" class="prodnote"/>
                        <html:figcaption id="caption1">
                            <html:p/>
                        </html:figcaption>
                    </html:figure>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img2" longdesc="#prodnote2" alt="image"/>
                        <html:aside id="prodnote2" epub:type="z3998:production" class="prodnote"/>
                        <html:figcaption>
                            <html:div id="caption2">
                                <html:p/>
                            </html:div>
                            <html:div id="caption3">
                                <html:p/>
                            </html:div>
                        </html:figcaption>
                    </html:figure>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img3" alt="image"/>
                    </html:figure>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img4" alt="image"/>
                        <html:figcaption id="caption4">
                            <html:p/>
                        </html:figcaption>
                    </html:figure>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img5" alt="image"/>
                    </html:figure>
                </html:figure>
            </x:expect>
        </x:scenario>
        <x:scenario label="with the children [caption, img, caption, caption, img, img, caption, img]">
            <x:context>
                <dtbook:imggroup>
                    <dtbook:caption id="caption1">
                        <dtbook:p/>
                    </dtbook:caption>
                    <dtbook:img src="img.jpg" id="img1"/>
                    <dtbook:caption id="caption2">
                        <dtbook:p/>
                    </dtbook:caption>
                    <dtbook:caption id="caption3">
                        <dtbook:p/>
                    </dtbook:caption>
                    <dtbook:img src="img.jpg" id="img2"/>
                    <dtbook:img src="img.jpg" id="img3"/>
                    <dtbook:caption id="caption4">
                        <dtbook:p/>
                    </dtbook:caption>
                    <dtbook:img src="img.jpg" id="img4"/>
                </dtbook:imggroup>
            </x:context>
            <x:expect label="the resulting element should be a figure">
                <html:figure id="..." class="image-series">
                    <html:figcaption id="caption1">
                        <html:p/>
                    </html:figcaption>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img1" alt="image"/>
                        <html:figcaption>
                            <html:div id="caption2">
                                <html:p/>
                            </html:div>
                            <html:div id="caption3">
                                <html:p/>
                            </html:div>
                        </html:figcaption>
                    </html:figure>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img2" alt="image"/>
                    </html:figure>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img3" alt="image"/>
                        <html:figcaption id="caption4">
                            <html:p/>
                        </html:figcaption>
                    </html:figure>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img4" alt="image"/>
                    </html:figure>
                </html:figure>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a caption containing text node(s)">
            <x:context>
                <dtbook:imggroup>
                    <dtbook:img src="img.jpg" id="img1"/>
                    <dtbook:caption id="caption1">TEXT</dtbook:caption>
                </dtbook:imggroup>
                <dtbook:imggroup>
                    <dtbook:caption id="caption2">TEXT</dtbook:caption>
                    <dtbook:img src="img.jpg" id="img2"/>
                    <dtbook:caption id="caption3">TEXT</dtbook:caption>
                    <dtbook:img src="img.jpg" id="img3"/>
                </dtbook:imggroup>
            </x:context>
            <x:expect label="the text nodes should remain as text nodes">
                <html:figure id="..." class="image">
                    <html:img src="images/img.jpg" id="img1" alt="image"/>
                    <html:figcaption id="caption1">TEXT</html:figcaption>
                </html:figure>
                <html:figure id="..." class="image-series">
                    <html:figcaption id="caption2">TEXT</html:figcaption>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img2" alt="image"/>
                        <html:figcaption id="caption3">TEXT</html:figcaption>
                    </html:figure>
                    <html:figure class="image">
                        <html:img src="images/img.jpg" id="img3" alt="image"/>
                    </html:figure>
                </html:figure>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.imggroup -->
    <!-- nothing interesting to test -->

    <!-- p -->
    <x:scenario label="when processing a p element">
        <x:scenario label="with some basic inline content">
            <x:context>
                <dtbook:p>TEXT</dtbook:p>
            </x:context>
            <x:expect label="the resulting element should be a p">
                <html:p>TEXT</html:p>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a list and a dl">
            <x:context>
                <dtbook:p id="paragraph">
                    <dtbook:span>A</dtbook:span>
                    <dtbook:list type="pl"/>
                    <dtbook:span>B</dtbook:span>
                    <dtbook:dl/>
                    <dtbook:span>C</dtbook:span>
                </dtbook:p>
            </x:context>
            <x:expect label="the lists should be unwrapped from the p">
                <html:div id="paragraph">
                    <html:p>
                        <html:span>A</html:span>
                    </html:p>
                    <html:ol id="..." class="list-style-type-none preformatted"/>
                    <html:p>
                        <html:span>B</html:span>
                    </html:p>
                    <html:dl id="..."/>
                    <html:p>
                        <html:span>C</html:span>
                    </html:p>
                </html:div>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a bunch of custom classes">
            <x:context>
                <dtbook:p class="custom classes should be allowed">TEXT</dtbook:p>
            </x:context>
            <x:expect label="the resulting element should be a p">
                <html:p class="custom classes should be allowed">TEXT</html:p>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.p -->
    <!-- nothing interesting to test -->

    <!-- doctitle -->
    <x:scenario label="when processing a doctitle element">
        <x:scenario label="where a level1 with the class titlepage is present in frontmatter and that level1 does not have a headline already">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:doctitle>TITLE</dtbook:doctitle>
                        <dtbook:level1 class="titlepage"/>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the top-level doctitle should not be used as the headline for that level">
                <html:body>
                    <html:header>
                        <html:h1 id="..." epub:type="fulltitle" class="title">TITLE</html:h1>
                    </html:header>
                    <html:section id="..." epub:type="frontmatter titlepage"/>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where a level with the class titlepage is present in frontmatter and that level does not have a headline already">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:doctitle>TITLE</dtbook:doctitle>
                        <dtbook:level class="titlepage"/>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the doctitle should not be used as the headline for that level">
                <html:body>
                    <html:header>
                        <html:h1 id="..." epub:type="fulltitle" class="title">TITLE</html:h1>
                    </html:header>
                    <html:section id="..." epub:type="frontmatter titlepage"/>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where a level1 with the class titlepage is present in frontmatter and that level1 already has a headline">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:doctitle>TITLE</dtbook:doctitle>
                        <dtbook:level1 class="titlepage">
                            <dtbook:h1>OTHER TITLE</dtbook:h1>
                            <dtbook:author>Author as direct child to titlepage (#1)</dtbook:author>
                            <dtbook:author>Author as direct child to titlepage (#2)</dtbook:author>
                        </dtbook:level1>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the doctitle should be used as the main h1; the level1/h1 should be used for the titlepage h1">
                <html:body>
                    <html:header>
                        <html:h1 id="..." epub:type="fulltitle" class="title">TITLE</html:h1>
                    </html:header>
                    <html:section id="..." epub:type="frontmatter titlepage">
                        <html:h1 id="..." epub:type="fulltitle" class="title">OTHER TITLE</html:h1>
                        <html:p epub:type="z3998:author" class="docauthor">Author as direct child to titlepage (#1)</html:p>
                        <html:p epub:type="z3998:author" class="docauthor">Author as direct child to titlepage (#2)</html:p>
                    </html:section>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where a level1 with the class titlepage is not present in frontmatter">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:doctitle>TITLE</dtbook:doctitle>
                        <dtbook:level1/>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the doctitle should not be used to create a titlepage">
                <html:body>
                    <html:header>
                        <html:h1 id="..." epub:type="fulltitle" class="title">TITLE</html:h1>
                    </html:header>
                    <html:section id="..." epub:type="frontmatter"/>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where the doctitle for some reason is not a direct child of frontmatter">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:level1>
                            <dtbook:doctitle>book/frontmatter/level1/doctitle</dtbook:doctitle>
                        </dtbook:level1>
                    </dtbook:frontmatter>
                    <dtbook:bodymatter>
                        <dtbook:level1>
                            <dtbook:h1>headline</dtbook:h1>
                            <dtbook:doctitle>book/bodymatter/level1/doctitle</dtbook:doctitle>
                        </dtbook:level1>
                    </dtbook:bodymatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the doctitle should become a p">
                <html:body>
                    <html:section id="..." epub:type="frontmatter">
                        <html:p id="..." epub:type="fulltitle" class="title">book/frontmatter/level1/doctitle</html:p>
                    </html:section>
                    <html:section id="..." epub:type="bodymatter chapter">
                        <html:h1 id="...">headline</html:h1>
                        <html:p id="..." epub:type="fulltitle" class="title">book/bodymatter/level1/doctitle</html:p>
                    </html:section>
                </html:body>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.doctitle -->
    <!-- implicit epub:type and class tested in element test, otherwise nothing interesting to test -->

    <!-- docauthor -->
    <x:scenario label="when processing a docauthor element">
        <x:scenario label="with a titlepage and doctitle present">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:doctitle>TITLE</dtbook:doctitle>
                        <dtbook:docauthor>DOCAUTHOR</dtbook:docauthor>
                        <dtbook:level1 class="titlepage"/>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the docauthor should be added as a paragraph after the headline for that level with an epub:type of 'z3998:author' and a class of 'docauthor'">
                <html:body>
                    <html:header>
                        <html:h1 id="..." epub:type="fulltitle" class="title">TITLE</html:h1>
                        <html:p epub:type="z3998:author" class="docauthor">DOCAUTHOR</html:p>
                    </html:header>
                    <html:section id="..." epub:type="frontmatter titlepage"/>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a titlepage and a pre-existing headline (using a level instead of level1)">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:doctitle>TITLE</dtbook:doctitle>
                        <dtbook:docauthor>DOCAUTHOR</dtbook:docauthor>
                        <dtbook:level class="titlepage">
                            <dtbook:h1>OTHER TITLE</dtbook:h1>
                        </dtbook:level>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the docauthor should not be added as a paragraph after the headline for that level">
                <html:body>
                    <html:header>
                        <html:h1 id="..." epub:type="fulltitle" class="title">TITLE</html:h1>
                        <html:p epub:type="z3998:author" class="docauthor">DOCAUTHOR</html:p>
                    </html:header>
                    <html:section id="..." epub:type="frontmatter titlepage">
                        <html:h1 id="...">OTHER TITLE</html:h1>
                    </html:section>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="with a titlepage and neither a doctitle nor a pre-existing titlepage h1">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:docauthor>DOCAUTHOR</dtbook:docauthor>
                        <dtbook:level1 class="titlepage"/>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the docauthor should not be added as a paragraph at the beginning of that level, it should still only be in the header">
                <html:body>
                    <html:header>
                        <html:p epub:type="z3998:author" class="docauthor">DOCAUTHOR</html:p>
                    </html:header>
                    <html:section id="..." epub:type="frontmatter titlepage"/>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where a level1 with the class titlepage is not present in frontmatter">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:docauthor>DOCAUTHOR</dtbook:docauthor>
                        <dtbook:level1/>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the docauthor should not be used to create a titlepage">
                <html:body>
                    <html:header>
                        <html:p epub:type="z3998:author" class="docauthor">DOCAUTHOR</html:p>
                    </html:header>
                    <html:section id="..." epub:type="frontmatter"/>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where the docauthor is not a direct child of frontmatter">
            <x:context>
                <dtbook:frontmatter>
                    <dtbook:level1>
                        <dtbook:docauthor>frontmatter/level1/docauthor</dtbook:docauthor>
                    </dtbook:level1>
                </dtbook:frontmatter>
            </x:context>
            <x:expect label="the docauthor should become a p">
                <html:section epub:type="frontmatter" id="...">
                    <html:p epub:type="z3998:author" class="docauthor">frontmatter/level1/docauthor</html:p>
                </html:section>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.docauthor -->
    <!-- implicit epub:type and class tested in element test, otherwise nothing interesting to test -->

    <!-- covertitle -->
    <x:scenario label="when processing a covertitle element">
        <x:scenario label="where a level1 with the class cover is present in frontmatter and that level1 does not have a headline already">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:covertitle>TITLE</dtbook:covertitle>
                        <dtbook:level1 class="cover"/>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the covertitle should not be used as the headline for that level">
                <html:body>
                    <html:header>
                        <html:p id="..." epub:type="covertitle" class="covertitle">TITLE</html:p>
                    </html:header>
                    <html:section id="..." epub:type="cover"/>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where a level with the class cover is present in frontmatter and that level does not have a headline already">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:covertitle>TITLE</dtbook:covertitle>
                        <dtbook:level class="cover"/>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the covertitle should not be used as the headline for that level">
                <html:body>
                    <html:header>
                        <html:p id="..." epub:type="covertitle" class="covertitle">TITLE</html:p>
                    </html:header>
                    <html:section id="..." epub:type="cover"/>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where a level1 with the class cover is present in frontmatter and that level1 already has a headline">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:covertitle>TITLE</dtbook:covertitle>
                        <dtbook:level1 class="cover">
                            <dtbook:h1>OTHER TITLE</dtbook:h1>
                        </dtbook:level1>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the covertitle should not be used as the headline for that level, the existing one should be used instead">
                <html:body>
                    <html:header>
                        <html:p id="..." epub:type="covertitle" class="covertitle">TITLE</html:p>
                    </html:header>
                    <html:section id="..." epub:type="cover">
                        <html:h1 id="...">OTHER TITLE</html:h1>
                    </html:section>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where a level1 with the class cover is not present in frontmatter">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:covertitle>TITLE</dtbook:covertitle>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the covertitle should not be used to create a cover">
                <html:body>
                    <html:header>
                        <html:p id="..." epub:type="covertitle" class="covertitle">TITLE</html:p>
                    </html:header>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="where the covertitle is not a direct child of frontmatter">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:level1>
                            <dtbook:covertitle>book/frontmatter/level1/covertitle</dtbook:covertitle>
                        </dtbook:level1>
                    </dtbook:frontmatter>
                    <dtbook:bodymatter>
                        <dtbook:level1>
                            <dtbook:h1>headline 1</dtbook:h1>
                            <dtbook:covertitle>book/bodymatter/level1[1]/covertitle</dtbook:covertitle>
                        </dtbook:level1>
                        <dtbook:level1>
                            <dtbook:doctitle>headline 2</dtbook:doctitle>
                            <dtbook:covertitle>book/bodymatter/level1[2]/covertitle</dtbook:covertitle>
                        </dtbook:level1>
                    </dtbook:bodymatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the covertitle should become a p">
                <html:body>
                    <html:section id="..." epub:type="frontmatter">
                        <html:p id="..." epub:type="covertitle" class="covertitle">book/frontmatter/level1/covertitle</html:p>
                    </html:section>
                    <html:section id="..." epub:type="bodymatter chapter">
                        <html:h1 id="...">headline 1</html:h1>
                        <html:p id="..." epub:type="covertitle" class="covertitle">book/bodymatter/level1[1]/covertitle</html:p>
                    </html:section>
                    <html:section id="..." epub:type="bodymatter chapter">
                        <html:p id="..." epub:type="fulltitle" class="title">headline 2</html:p>
                        <html:p id="..." epub:type="covertitle" class="covertitle">book/bodymatter/level1[2]/covertitle</html:p>
                    </html:section>
                </html:body>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.covertitle -->
    <!-- implicit epub:type and class tested in element test, otherwise nothing interesting to test -->

    <!-- h1 -->
    <x:scenario label="when processing the h1-h6 elements">
        <x:context>
            <dtbook:book>
                <dtbook:frontmatter>
                    <dtbook:doctitle>doctitle</dtbook:doctitle>
                    <dtbook:level1>
                        <dtbook:h1>h1</dtbook:h1>
                        <dtbook:level2>
                            <dtbook:h2>h2</dtbook:h2>
                        </dtbook:level2>
                    </dtbook:level1>
                </dtbook:frontmatter>
                <dtbook:bodymatter>
                    <dtbook:level1>
                        <dtbook:h1>h1</dtbook:h1>
                        <dtbook:level2>
                            <dtbook:h2>h2</dtbook:h2>
                            <dtbook:level3>
                                <dtbook:h3>h3</dtbook:h3>
                                <dtbook:level4>
                                    <dtbook:h4>h4</dtbook:h4>
                                    <dtbook:level5>
                                        <dtbook:h5>h5</dtbook:h5>
                                        <dtbook:level6>
                                            <dtbook:h6>h6</dtbook:h6>
                                        </dtbook:level6>
                                    </dtbook:level5>
                                </dtbook:level4>
                            </dtbook:level3>
                        </dtbook:level2>
                    </dtbook:level1>
                </dtbook:bodymatter>
            </dtbook:book>
        </x:context>
        <x:expect label="the resulting element should be h1-h6 elements">
            <html:body>
                <html:header>
                    <html:h1 id="..." epub:type="fulltitle" class="title">doctitle</html:h1>
                </html:header>
                <html:section id="..." epub:type="frontmatter">
                    <html:h1 id="...">h1</html:h1>
                    <html:section id="...">
                        <html:h2 id="...">h2</html:h2>
                    </html:section>
                </html:section>
                <html:section id="..." epub:type="bodymatter chapter">
                    <html:h1 id="...">h1</html:h1>
                    <html:section id="...">
                        <html:h2 id="...">h2</html:h2>
                        <html:section id="...">
                            <html:h3 id="...">h3</html:h3>
                            <html:section id="...">
                                <html:h4 id="...">h4</html:h4>
                                <html:section id="...">
                                    <html:h5 id="...">h5</html:h5>
                                    <html:section id="...">
                                        <html:h6 id="...">h6</html:h6>
                                    </html:section>
                                </html:section>
                            </html:section>
                        </html:section>
                    </html:section>
                </html:section>
            </html:body>
        </x:expect>
    </x:scenario>

    <!-- h1 -->
    <x:scenario label="when processing a h1 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:h1>h1</dtbook:h1>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a h1">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:h1 id="...">h1</html:h1>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.h1 -->
    <!-- nothing interesting to test -->

    <!-- h2 -->
    <x:scenario label="when processing a h2 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:h1>h1</dtbook:h1>
                    <dtbook:level2>
                        <dtbook:h2>h2</dtbook:h2>
                    </dtbook:level2>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a h2">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:h1 id="...">h1</html:h1>
                <html:section id="...">
                    <html:h2 id="...">h2</html:h2>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.h2 -->
    <!-- nothing interesting to test -->

    <!-- h3 -->
    <x:scenario label="when processing a h3 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:h1>h1</dtbook:h1>
                    <dtbook:level2>
                        <dtbook:h2>h2</dtbook:h2>
                        <dtbook:level3>
                            <dtbook:h3>h3</dtbook:h3>
                        </dtbook:level3>
                    </dtbook:level2>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a h3">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:h1 id="...">h1</html:h1>
                <html:section id="...">
                    <html:h2 id="...">h2</html:h2>
                    <html:section id="...">
                        <html:h3 id="...">h3</html:h3>
                    </html:section>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.h3 -->
    <!-- nothing interesting to test -->

    <!-- h4 -->
    <x:scenario label="when processing a h4 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:h1>h1</dtbook:h1>
                    <dtbook:level2>
                        <dtbook:h2>h2</dtbook:h2>
                        <dtbook:level3>
                            <dtbook:h3>h3</dtbook:h3>
                            <dtbook:level4>
                                <dtbook:h4>h4</dtbook:h4>
                            </dtbook:level4>
                        </dtbook:level3>
                    </dtbook:level2>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a h4">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:h1 id="...">h1</html:h1>
                <html:section id="...">
                    <html:h2 id="...">h2</html:h2>
                    <html:section id="...">
                        <html:h3 id="...">h3</html:h3>
                        <html:section id="...">
                            <html:h4 id="...">h4</html:h4>
                        </html:section>
                    </html:section>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.h4 -->
    <!-- nothing interesting to test -->

    <!-- h5 -->
    <x:scenario label="when processing a h5 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:h1>h1</dtbook:h1>
                    <dtbook:level2>
                        <dtbook:h2>h2</dtbook:h2>
                        <dtbook:level3>
                            <dtbook:h3>h3</dtbook:h3>
                            <dtbook:level4>
                                <dtbook:h4>h4</dtbook:h4>
                                <dtbook:level5>
                                    <dtbook:h5>h5</dtbook:h5>
                                </dtbook:level5>
                            </dtbook:level4>
                        </dtbook:level3>
                    </dtbook:level2>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a h5">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:h1 id="...">h1</html:h1>
                <html:section id="...">
                    <html:h2 id="...">h2</html:h2>
                    <html:section id="...">
                        <html:h3 id="...">h3</html:h3>
                        <html:section id="...">
                            <html:h4 id="...">h4</html:h4>
                            <html:section id="...">
                                <html:h5 id="...">h5</html:h5>
                            </html:section>
                        </html:section>
                    </html:section>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.h5 -->
    <!-- nothing interesting to test -->

    <!-- h6 -->
    <x:scenario label="when processing a h6 element">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level1>
                    <dtbook:h1>h1</dtbook:h1>
                    <dtbook:level2>
                        <dtbook:h2>h2</dtbook:h2>
                        <dtbook:level3>
                            <dtbook:h3>h3</dtbook:h3>
                            <dtbook:level4>
                                <dtbook:h4>h4</dtbook:h4>
                                <dtbook:level5>
                                    <dtbook:h5>h5</dtbook:h5>
                                    <dtbook:level6>
                                        <dtbook:h6>h6</dtbook:h6>
                                    </dtbook:level6>
                                </dtbook:level5>
                            </dtbook:level4>
                        </dtbook:level3>
                    </dtbook:level2>
                </dtbook:level1>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be a h6">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:h1 id="...">h1</html:h1>
                <html:section id="...">
                    <html:h2 id="...">h2</html:h2>
                    <html:section id="...">
                        <html:h3 id="...">h3</html:h3>
                        <html:section id="...">
                            <html:h4 id="...">h4</html:h4>
                            <html:section id="...">
                                <html:h5 id="...">h5</html:h5>
                                <html:section id="...">
                                    <html:h6 id="...">h6</html:h6>
                                </html:section>
                            </html:section>
                        </html:section>
                    </html:section>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.h6 -->
    <!-- nothing interesting to test -->

    <!-- bridgehead -->
    <x:scenario label="when processing a bridgehead">
        <x:context>
            <dtbook:bridgehead>TEXT</dtbook:bridgehead>
        </x:context>
        <x:expect label="the result should be a p with a epub:type of bridgehead">
            <html:p epub:type="bridgehead" class="bridgehead">TEXT</html:p>
        </x:expect>
    </x:scenario>

    <!-- attlist.bridgehead -->
    <!-- nothing interesting to test -->

    <!-- hd -->
    <x:scenario label="when processing a hd element (seven levels deep)">
        <x:context>
            <dtbook:bodymatter>
                <dtbook:level>
                    <dtbook:hd>h1</dtbook:hd>
                    <dtbook:level>
                        <dtbook:hd>h2</dtbook:hd>
                        <dtbook:level>
                            <dtbook:hd>h3</dtbook:hd>
                            <dtbook:level>
                                <dtbook:hd>h4</dtbook:hd>
                                <dtbook:level>
                                    <dtbook:hd>h5</dtbook:hd>
                                    <dtbook:level>
                                        <dtbook:hd>h6</dtbook:hd>
                                        <dtbook:level>
                                            <dtbook:hd>h7</dtbook:hd>
                                        </dtbook:level>
                                    </dtbook:level>
                                </dtbook:level>
                            </dtbook:level>
                        </dtbook:level>
                    </dtbook:level>
                </dtbook:level>
            </dtbook:bodymatter>
        </x:context>
        <x:expect label="the resulting element should be h1,h2,h3,h4,h5,h6,h6 (h6 for level depth 6 and up)">
            <html:section id="..." epub:type="bodymatter chapter">
                <html:h1 id="...">h1</html:h1>
                <html:section id="...">
                    <html:h2 id="...">h2</html:h2>
                    <html:section id="...">
                        <html:h3 id="...">h3</html:h3>
                        <html:section id="...">
                            <html:h4 id="...">h4</html:h4>
                            <html:section id="...">
                                <html:h5 id="...">h5</html:h5>
                                <html:section id="...">
                                    <html:h6 id="...">h6</html:h6>
                                    <html:section id="...">
                                        <html:h6 id="...">h7</html:h6>
                                    </html:section>
                                </html:section>
                            </html:section>
                        </html:section>
                    </html:section>
                </html:section>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- attlist.hd -->
    <!-- nothing interesting to test -->

    <!-- blockquote -->
    <x:scenario label="when processing a blockquote element">
        <x:context>
            <dtbook:blockquote>TEXT</dtbook:blockquote>
        </x:context>
        <x:expect label="the resulting element should be blockquote">
            <html:blockquote id="...">TEXT</html:blockquote>
        </x:expect>
    </x:scenario>

    <!-- attlist.blockquote -->
    <x:scenario label="when processing the blockquote element attributes">
        <x:context>
            <dtbook:blockquote cite="#target">TEXT</dtbook:blockquote>
        </x:context>
        <x:expect label="the cite attribute should be copied when present">
            <html:blockquote id="..." cite="#target">TEXT</html:blockquote>
        </x:expect>
    </x:scenario>

    <!-- dl -->
    <x:scenario label="when processing a dl element">
        <x:scenario label="without any pagenums">
            <x:context>
                <dtbook:dl>
                    <dtbook:dt>dt</dtbook:dt>
                    <dtbook:dd>dd</dtbook:dd>
                </dtbook:dl>
            </x:context>
            <x:expect label="the resulting element should be dl">
                <html:dl id="...">
                    <html:dt id="...">dt</html:dt>
                    <html:dd>dd</html:dd>
                </html:dl>
            </x:expect>
        </x:scenario>
        <x:scenario label="with pagenum children">
            <x:context>
                <dtbook:dl>
                    <dtbook:pagenum>1</dtbook:pagenum>
                    <dtbook:pagenum>2</dtbook:pagenum>
                    <dtbook:dt>dt #1</dtbook:dt>
                    <dtbook:pagenum>3</dtbook:pagenum>
                    <dtbook:pagenum>4</dtbook:pagenum>
                    <dtbook:dd>dd #1</dtbook:dd>
                    <dtbook:pagenum>5</dtbook:pagenum>
                    <dtbook:pagenum>6</dtbook:pagenum>
                    <dtbook:dt>dt #2</dtbook:dt>
                    <dtbook:pagenum>7</dtbook:pagenum>
                    <dtbook:pagenum>8</dtbook:pagenum>
                    <dtbook:dd>dd #2</dtbook:dd>
                    <dtbook:pagenum>9</dtbook:pagenum>
                    <dtbook:pagenum>10</dtbook:pagenum>
                </dtbook:dl>
            </x:context>
            <x:expect label="the resulting element should be dl">
                <html:div epub:type="pagebreak" title="1" class="page-normal"/>
                <html:div epub:type="pagebreak" title="2" class="page-normal"/>
                <html:dl id="...">
                    <html:dt id="...">dt #1 <html:span epub:type="pagebreak" title="3" class="page-normal"/><html:span epub:type="pagebreak" title="4" class="page-normal"/></html:dt>
                    <html:dd>dd #1 <html:span epub:type="pagebreak" title="5" class="page-normal"/>
                        <html:span epub:type="pagebreak" title="6" class="page-normal"/></html:dd>
                    <html:dt id="...">dt #2 <html:span epub:type="pagebreak" title="7" class="page-normal"/><html:span epub:type="pagebreak" title="8" class="page-normal"/></html:dt>
                    <html:dd>dd #2</html:dd>
                </html:dl>
                <html:div epub:type="pagebreak" title="9" class="page-normal"/>
                <html:div epub:type="pagebreak" title="10" class="page-normal"/>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.dl -->
    <!-- nothing interesting to test -->

    <!-- dt -->
    <x:scenario label="when processing a dt element">
        <x:context>
            <dtbook:dt>TEXT</dtbook:dt>
        </x:context>
        <x:expect label="the resulting element should be a dt">
            <html:dt id="...">TEXT</html:dt>
        </x:expect>
    </x:scenario>

    <!-- attlist.dt -->
    <!-- nothing interesting to test -->

    <!-- dd -->
    <x:scenario label="when processing a dd element">
        <x:context>
            <dtbook:dd>TEXT</dtbook:dd>
        </x:context>
        <x:expect label="the resulting element should be a dd">
            <html:dd>TEXT</html:dd>
        </x:expect>
    </x:scenario>

    <!-- attlist.dd -->
    <!-- nothing interesting to test -->

    <!-- list -->
    <x:scenario label="when processing a list element">
        <x:scenario label="which has a headline">
            <x:context>
                <dtbook:list type="pl">
                    <dtbook:hd>TEXT</dtbook:hd>
                </dtbook:list>
            </x:context>
            <x:expect label="the resulting list should be wrapped in a section element">
                <html:section id="...">...</html:section>
            </x:expect>
        </x:scenario>
        <x:scenario label="which is ordered">
            <x:context>
                <dtbook:list type="ol">
                    <dtbook:li>TEXT</dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the resulting element should be a ol">
                <html:ol id="..." class="list-style-type-none">
                    <html:li id="...">TEXT</html:li>
                </html:ol>
            </x:expect>
        </x:scenario>
        <x:scenario label="which is unordered">
            <x:context>
                <dtbook:list type="ul">
                    <dtbook:li>TEXT</dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the resulting element should be a ul">
                <html:ul id="..." class="list-style-type-none">
                    <html:li id="...">TEXT</html:li>
                </html:ul>
            </x:expect>
        </x:scenario>
        <x:scenario label="which is preformatted">
            <x:context>
                <dtbook:list type="pl">
                    <dtbook:li>TEXT</dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the resulting element should be a ol">
                <html:ol id="..." class="list-style-type-none preformatted">
                    <html:li id="...">TEXT</html:li>
                </html:ol>
            </x:expect>
        </x:scenario>
        <x:scenario label="which has a li with one span and one nested list">
            <x:context>
                <dtbook:list type="pl">
                    <dtbook:li>
                        <dtbook:span>TEXT</dtbook:span>
                        <dtbook:list type="pl">
                            <dtbook:li>TEXT</dtbook:li>
                        </dtbook:list>
                    </dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the result should be one span and one nested list">
                <html:ol id="..." class="list-style-type-none preformatted">
                    <html:li id="...">
                        <html:span>TEXT</html:span>
                        <html:ol id="..." class="list-style-type-none preformatted">
                            <html:li id="...">TEXT</html:li>
                        </html:ol>
                    </html:li>
                </html:ol>
            </x:expect>
        </x:scenario>
        <x:scenario label="which has a li with one lic and one nested list">
            <x:context>
                <dtbook:list type="pl">
                    <dtbook:li>
                        <dtbook:lic>
                            <dtbook:span>TEXT</dtbook:span>
                        </dtbook:lic>
                        <dtbook:list type="pl">
                            <dtbook:li>TEXT</dtbook:li>
                        </dtbook:list>
                    </dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the result should be the contents of the lic and one nested list">
                <html:ol id="..." class="list-style-type-none preformatted">
                    <html:li id="...">
                        <html:span class="lic">
                            <html:span>TEXT</html:span>
                        </html:span>
                        <html:ol id="..." class="list-style-type-none preformatted">
                            <html:li id="...">TEXT</html:li>
                        </html:ol>
                    </html:li>
                </html:ol>
            </x:expect>
        </x:scenario>
        <x:scenario label="which has a li with two lics and one nested list">
            <x:context>
                <dtbook:list type="pl">
                    <dtbook:li>
                        <dtbook:lic>
                            <dtbook:span>TEXT</dtbook:span>
                        </dtbook:lic>
                        <dtbook:lic>
                            <dtbook:span>TEXT</dtbook:span>
                        </dtbook:lic>
                        <dtbook:list type="pl">
                            <dtbook:li>TEXT</dtbook:li>
                        </dtbook:list>
                    </dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the result should be two lics and one nested list">
                <html:ol id="..." class="list-style-type-none preformatted">
                    <html:li id="...">
                        <html:span class="lic">
                            <html:span>TEXT</html:span>
                        </html:span>
                        <html:span class="lic">
                            <html:span>TEXT</html:span>
                        </html:span>
                        <html:ol id="..." class="list-style-type-none preformatted">
                            <html:li id="...">TEXT</html:li>
                        </html:ol>
                    </html:li>
                </html:ol>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.list -->
    <x:scenario label="when processing the list element attributes">
        <x:context>
            <dtbook:list type="pl" depth="1" enum="1" start="1">
                <dtbook:li>TEXT</dtbook:li>
            </dtbook:list>
        </x:context>
        <x:expect label="the resulting list should be wrapped in a section element">
            <html:ol id="..." start="1" class="list-style-type-none preformatted">
                <html:li id="...">TEXT</html:li>
            </html:ol>
        </x:expect>
    </x:scenario>

    <!-- li -->
    <x:scenario label="when processing a li element">
        <x:context>
            <dtbook:li>TEXT</dtbook:li>
        </x:context>
        <x:expect label="the resulting element should be a li">
            <html:li id="...">TEXT</html:li>
        </x:expect>
        <x:scenario label="with bullets in either block or inline context">
            <x:context>
                <dtbook:list type="pl" depth="1">
                    <dtbook:li id="li_814"><dtbook:p>• TEXT1 <dtbook:em>TEXT2</dtbook:em> TEXT3</dtbook:p>
                        <dtbook:list type="pl" id="list_213" depth="2">
                            <dtbook:li id="li_815">• TEXT4 <dtbook:em>TEXT5 </dtbook:em> TEXT6</dtbook:li>
                        </dtbook:list>
                    </dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the result should become ul and the bullets should be removed">
                <html:ul id="..." class="preformatted">
                    <html:li id="li_814"><html:p>TEXT1 <html:em>TEXT2</html:em> TEXT3</html:p>
                        <html:ul id="list_213" class="preformatted">
                            <html:li id="li_815">TEXT4 <html:em>TEXT5 </html:em> TEXT6</html:li>
                        </html:ul>
                    </html:li>
                </html:ul>
            </x:expect>
        </x:scenario>
        <x:scenario label="with ordered list and both block and non-block text content">
            <x:context>
                <dtbook:list type="pl" depth="1">
                    <dtbook:li id="li_814"><dtbook:p>1. TEXT1 <dtbook:em>TEXT2</dtbook:em> TEXT3</dtbook:p>
                        <dtbook:list type="pl" id="list_213" depth="2">
                            <dtbook:li id="li_815">1. TEXT4 <dtbook:em>TEXT5 </dtbook:em> TEXT6</dtbook:li>
                        </dtbook:list>
                    </dtbook:li>
                    <dtbook:li>2. TEXT7</dtbook:li>
                    <dtbook:li>9. TEXT8</dtbook:li>
                    <dtbook:li>10. TEXT9</dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the ul should become list, bullets should be added to text or block content as necessary">
                <html:ol id="..." class="preformatted">
                    <html:li id="li_814" value="1"><html:p>TEXT1 <html:em>TEXT2</html:em> TEXT3</html:p>
                        <html:ol id="list_213" class="preformatted">
                            <html:li id="li_815" value="1">TEXT4 <html:em>TEXT5 </html:em> TEXT6</html:li>
                        </html:ol>
                    </html:li>
                    <html:li id="..." value="2">TEXT7</html:li>
                    <html:li id="..." value="9">TEXT8</html:li>
                    <html:li id="..." value="10">TEXT9</html:li>
                </html:ol>
            </x:expect>
        </x:scenario>
        <x:scenario label="with preformatted ordered lists using different marker types (roman numerals, letters, numbers)">
            <x:context>
                <dtbook:list type="pl" depth="1">
                    <dtbook:li>1. ONE</dtbook:li>
                    <dtbook:li>2. TWO</dtbook:li>
                </dtbook:list>
                <dtbook:list type="pl" depth="1">
                    <dtbook:li>a. ONE</dtbook:li>
                    <dtbook:li>b. TWO</dtbook:li>
                </dtbook:list>
                <dtbook:list type="pl" depth="1">
                    <dtbook:li>A. ONE</dtbook:li>
                    <dtbook:li>B. TWO</dtbook:li>
                </dtbook:list>
                <dtbook:list type="pl" depth="1">
                    <dtbook:li>i. ONE</dtbook:li>
                    <dtbook:li>ii. TWO</dtbook:li>
                </dtbook:list>
                <dtbook:list type="pl" depth="1">
                    <dtbook:li>I. ONE</dtbook:li>
                    <dtbook:li>II. TWO</dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the type of list should be detected, and the list markers removed">
                <html:ol id="..." class="preformatted">
                    <html:li id="..." value="1">ONE</html:li>
                    <html:li id="..." value="2">TWO</html:li>
                </html:ol>
                <html:ol id="..." type="a" class="preformatted">
                    <html:li id="..." value="1">ONE</html:li>
                    <html:li id="..." value="2">TWO</html:li>
                </html:ol>
                <html:ol id="..." type="A" class="preformatted">
                    <html:li id="..." value="1">ONE</html:li>
                    <html:li id="..." value="2">TWO</html:li>
                </html:ol>
                <html:ol id="..." type="i" class="preformatted">
                    <html:li id="..." value="1">ONE</html:li>
                    <html:li id="..." value="2">TWO</html:li>
                </html:ol>
                <html:ol id="..." type="I" class="preformatted">
                    <html:li id="..." value="1">ONE</html:li>
                    <html:li id="..." value="2">TWO</html:li>
                </html:ol>
            </x:expect>
        </x:scenario>
        <x:scenario label="with ol and reversed order">
            <x:context>
                <dtbook:list type="pl" depth="1">
                    <dtbook:li>10. ONE</dtbook:li>
                    <dtbook:li>9. TWO</dtbook:li>
                    <dtbook:li>5. THREE</dtbook:li>
                    <dtbook:li>4. FOUR</dtbook:li>
                </dtbook:list>
            </x:context>
            <x:expect label="the result should be 10, 9, 5, 4">
                <html:ol id="..." class="preformatted">
                    <html:li id="..." value="10">ONE</html:li>
                    <html:li id="..." value="9">TWO</html:li>
                    <html:li id="..." value="5">THREE</html:li>
                    <html:li id="..." value="4">FOUR</html:li>
                </html:ol>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.li -->
    <!-- nothing interesting to test -->

    <!-- lic -->
    <x:scenario label="when processing a lic element">
        <x:context>
            <dtbook:lic>TEXT</dtbook:lic>
        </x:context>
        <x:expect label="the resulting element should be a span with a class of lic">
            <html:span class="lic">TEXT</html:span>
        </x:expect>
    </x:scenario>

    <!-- attlist.lic -->
    <!-- nothing interesting to test -->

    <!-- Scope -->
    <!-- no point in testing -->

    <!-- TFrame -->
    <!-- no point in testing -->

    <!-- TRules -->
    <!-- no point in testing -->

    <!-- cellhalign -->
    <!-- tested in attlist.td -->

    <!-- cellvalign -->
    <!-- tested in attlist.td -->

    <!-- table -->
    <x:scenario label="when processing a table element">
        <x:scenario label="...just a basic one">
            <x:context>
                <dtbook:table>
                    <dtbook:tr>
                        <dtbook:td>TEXT</dtbook:td>
                    </dtbook:tr>
                </dtbook:table>
            </x:context>
            <x:expect label="the resulting element should be a table">
                <html:table id="...">...</html:table>
            </x:expect>
        </x:scenario>
        <x:scenario label="with pagenum children">
            <x:context>
                <dtbook:table>
                    <dtbook:pagenum>1</dtbook:pagenum>
                    <dtbook:pagenum>2</dtbook:pagenum>
                    <dtbook:tr>
                        <dtbook:td>td #1</dtbook:td>
                    </dtbook:tr>
                    <dtbook:pagenum>3</dtbook:pagenum>
                    <dtbook:pagenum>4</dtbook:pagenum>
                    <dtbook:tr>
                        <dtbook:td>td #2</dtbook:td>
                    </dtbook:tr>
                    <dtbook:pagenum>5</dtbook:pagenum>
                    <dtbook:pagenum>6</dtbook:pagenum>
                    <dtbook:tr>
                        <dtbook:td>td #3</dtbook:td>
                    </dtbook:tr>
                    <dtbook:pagenum>7</dtbook:pagenum>
                    <dtbook:pagenum>8</dtbook:pagenum>
                    <dtbook:tr>
                        <dtbook:td>td #4</dtbook:td>
                    </dtbook:tr>
                    <dtbook:pagenum>9</dtbook:pagenum>
                    <dtbook:pagenum>10</dtbook:pagenum>
                </dtbook:table>
            </x:context>
            <x:expect label="the resulting element should be table, with pagebreaks moved before or after the table element, or inside the table cells">
                <html:div epub:type="pagebreak" title="1" class="page-normal"/>
                <html:div epub:type="pagebreak" title="2" class="page-normal"/>
                <html:table id="...">
                    <html:tbody>
                        <html:tr>
                            <html:td>td #1</html:td>
                        </html:tr>
                        <html:tr>
                            <html:td><html:span epub:type="pagebreak" title="3" class="page-normal"/><html:span epub:type="pagebreak" title="4" class="page-normal"/>td #2</html:td>
                        </html:tr>
                        <html:tr>
                            <html:td><html:span epub:type="pagebreak" title="5" class="page-normal"/><html:span epub:type="pagebreak" title="6" class="page-normal"/>td #3</html:td>
                        </html:tr>
                        <html:tr>
                            <html:td><html:span epub:type="pagebreak" title="7" class="page-normal"/><html:span epub:type="pagebreak" title="8" class="page-normal"/>td #4</html:td>
                        </html:tr>
                    </html:tbody>
                </html:table>
                <html:div epub:type="pagebreak" title="9" class="page-normal"/>
                <html:div epub:type="pagebreak" title="10" class="page-normal"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="with pagenum, thead and tr children">
            <x:context>
                <dtbook:table>
                    <dtbook:thead>
                        <dtbook:tr>
                            <dtbook:th>thead th #1</dtbook:th>
                            <dtbook:th>thead th #2</dtbook:th>
                        </dtbook:tr>
                        <dtbook:tr>
                            <dtbook:th>thead th #3</dtbook:th>
                            <dtbook:th>thead th #4</dtbook:th>
                        </dtbook:tr>
                    </dtbook:thead>
                    <dtbook:pagenum>1</dtbook:pagenum>
                    <dtbook:pagenum>2</dtbook:pagenum>
                    <dtbook:tr><dtbook:td>td #1</dtbook:td></dtbook:tr>
                    <dtbook:pagenum>3</dtbook:pagenum>
                    <dtbook:pagenum>4</dtbook:pagenum>
                    <dtbook:tr><dtbook:td>td #2</dtbook:td></dtbook:tr>
                    <dtbook:pagenum>5</dtbook:pagenum>
                    <dtbook:pagenum>6</dtbook:pagenum>
                </dtbook:table>
            </x:context>
            <x:expect label="the resulting element should be table, with pagebreaks moved before or after the table element, or inside the table cells">
                <html:div epub:type="pagebreak" title="1" class="page-normal"/>
                <html:div epub:type="pagebreak" title="2" class="page-normal"/>
                <html:table id="...">
                    <html:thead>
                        <html:tr>
                            <html:th>thead th #1</html:th>
                            <html:th>thead th #2</html:th>
                        </html:tr>
                        <html:tr>
                            <html:th>thead th #3</html:th>
                            <html:th>thead th #4</html:th>
                        </html:tr>
                    </html:thead>
                    <html:tbody>
                        <html:tr><html:td>td #1</html:td></html:tr>
                        <html:tr><html:td><html:span epub:type="pagebreak" title="3" class="page-normal"/><html:span epub:type="pagebreak" title="4" class="page-normal"/>td #2</html:td></html:tr>
                    </html:tbody>
                </html:table>
                <html:div epub:type="pagebreak" title="5" class="page-normal"/>
                <html:div epub:type="pagebreak" title="6" class="page-normal"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="with pagenum, tfoot and tr children">
            <x:context>
                <dtbook:table>
                    <dtbook:tfoot>
                        <dtbook:tr>
                            <dtbook:td>tfoot td #1</dtbook:td>
                            <dtbook:td>tfoot td #2</dtbook:td>
                        </dtbook:tr>
                        <dtbook:tr>
                            <dtbook:td>tfoot td #3</dtbook:td>
                            <dtbook:td>tfoot td #4</dtbook:td>
                        </dtbook:tr>
                    </dtbook:tfoot>
                    <dtbook:pagenum>1</dtbook:pagenum>
                    <dtbook:pagenum>2</dtbook:pagenum>
                    <dtbook:tr><dtbook:td>td #1</dtbook:td></dtbook:tr>
                    <dtbook:pagenum>3</dtbook:pagenum>
                    <dtbook:pagenum>4</dtbook:pagenum>
                    <dtbook:tr><dtbook:td>td #2</dtbook:td></dtbook:tr>
                    <dtbook:pagenum>5</dtbook:pagenum>
                    <dtbook:pagenum>6</dtbook:pagenum>
                </dtbook:table>
            </x:context>
            <x:expect label="the resulting element should be table, with pagebreaks moved before or after the table element, or inside the table cells">
                <html:div epub:type="pagebreak" title="1" class="page-normal"/>
                <html:div epub:type="pagebreak" title="2" class="page-normal"/>
                <html:table id="...">
                    <html:tfoot>
                        <html:tr>
                            <html:td>tfoot td #1</html:td>
                            <html:td>tfoot td #2</html:td>
                        </html:tr>
                        <html:tr>
                            <html:td>tfoot td #3</html:td>
                            <html:td>tfoot td #4</html:td>
                        </html:tr>
                    </html:tfoot>
                    <html:tbody>
                        <html:tr><html:td>td #1</html:td></html:tr>
                        <html:tr><html:td><html:span epub:type="pagebreak" title="3" class="page-normal"/><html:span epub:type="pagebreak" title="4" class="page-normal"/>td #2</html:td></html:tr>
                    </html:tbody>
                </html:table>
                <html:div epub:type="pagebreak" title="5" class="page-normal"/>
                <html:div epub:type="pagebreak" title="6" class="page-normal"/>
            </x:expect>
        </x:scenario>
        <x:scenario label="with thead, tfoot and tbody children, and pagenum children inside the tbody">
            <x:context>
                <dtbook:table>
                    <dtbook:thead>
                        <dtbook:tr>
                            <dtbook:th>thead th #1</dtbook:th>
                            <dtbook:th>thead th #2</dtbook:th>
                        </dtbook:tr>
                        <dtbook:tr>
                            <dtbook:th>thead th #3</dtbook:th>
                            <dtbook:th>thead th #4</dtbook:th>
                        </dtbook:tr>
                    </dtbook:thead>
                    <dtbook:tfoot>
                        <dtbook:tr>
                            <dtbook:td>tfoot td #1</dtbook:td>
                            <dtbook:td>tfoot td #2</dtbook:td>
                        </dtbook:tr>
                        <dtbook:tr>
                            <dtbook:td>tfoot td #3</dtbook:td>
                            <dtbook:td>tfoot td #4</dtbook:td>
                        </dtbook:tr>
                    </dtbook:tfoot>
                    <dtbook:tbody>
                        <dtbook:pagenum>1</dtbook:pagenum>
                        <dtbook:pagenum>2</dtbook:pagenum>
                        <dtbook:tr><dtbook:td>td #1</dtbook:td></dtbook:tr>
                        <dtbook:pagenum>3</dtbook:pagenum>
                        <dtbook:pagenum>4</dtbook:pagenum>
                        <dtbook:tr><dtbook:td>td #2</dtbook:td></dtbook:tr>
                        <dtbook:pagenum>5</dtbook:pagenum>
                        <dtbook:pagenum>6</dtbook:pagenum>
                    </dtbook:tbody>
                </dtbook:table>
            </x:context>
            <x:expect label="the resulting element should be table, with pagebreaks moved before or after the table element, or inside the table cells">
                <html:div epub:type="pagebreak" title="1" class="page-normal"/>
                <html:div epub:type="pagebreak" title="2" class="page-normal"/>
                <html:table id="...">
                    <html:thead>
                        <html:tr>
                            <html:th>thead th #1</html:th>
                            <html:th>thead th #2</html:th>
                        </html:tr>
                        <html:tr>
                            <html:th>thead th #3</html:th>
                            <html:th>thead th #4</html:th>
                        </html:tr>
                    </html:thead>
                    <html:tfoot>
                        <html:tr>
                            <html:td>tfoot td #1</html:td>
                            <html:td>tfoot td #2</html:td>
                        </html:tr>
                        <html:tr>
                            <html:td>tfoot td #3</html:td>
                            <html:td>tfoot td #4</html:td>
                        </html:tr>
                    </html:tfoot>
                    <html:tbody>
                        <html:tr><html:td>td #1</html:td></html:tr>
                        <html:tr><html:td><html:span epub:type="pagebreak" title="3" class="page-normal"/><html:span epub:type="pagebreak" title="4" class="page-normal"/>td #2</html:td></html:tr>
                    </html:tbody>
                </html:table>
                <html:div epub:type="pagebreak" title="5" class="page-normal"/>
                <html:div epub:type="pagebreak" title="6" class="page-normal"/>
            </x:expect>
        </x:scenario>
        <!-- TODO: table captions
        <x:scenario label="with pagenum and caption children">
            <x:context>
                <dtbook:table>
                    <dtbook:pagenum>1</dtbook:pagenum>
                    <dtbook:pagenum>2</dtbook:pagenum>
                    <dtbook:tr><dtbook:td>td #1</dtbook:td></dtbook:tr>
                    <dtbook:pagenum>3</dtbook:pagenum>
                    <dtbook:pagenum>4</dtbook:pagenum>
                    <dtbook:tr><dtbook:td>td #2</dtbook:td></dtbook:tr>
                    <dtbook:pagenum>5</dtbook:pagenum>
                    <dtbook:pagenum>6</dtbook:pagenum>
                    <dtbook:tr><dtbook:td>td #3</dtbook:td></dtbook:tr>
                    <dtbook:pagenum>7</dtbook:pagenum>
                    <dtbook:pagenum>8</dtbook:pagenum>
                    <dtbook:tr><dtbook:td>td #4</dtbook:td></dtbook:tr>
                    <dtbook:pagenum>9</dtbook:pagenum>
                    <dtbook:pagenum>10</dtbook:pagenum>
                </dtbook:table>
            </x:context>
            <x:expect label="the resulting element should be table">
                <html:div epub:type="pagebreak" title="1" class="page-normal"/>
                <html:div epub:type="pagebreak" title="2" class="page-normal"/>
                <html:table id="...">
                    <html:tbody>
                        <html:tr><html:td>td #1 <html:span epub:type="pagebreak" title="3" class="page-normal"/><html:span epub:type="pagebreak" title="4" class="page-normal"/></html:td></html:tr>
                        <html:tr><html:td>td #2 <html:span epub:type="pagebreak" title="5" class="page-normal"/>
                                <html:span epub:type="pagebreak" title="6" class="page-normal"/></html:td></html:tr>
                        <html:tr><html:td>td #3 <html:span epub:type="pagebreak" title="7" class="page-normal"/><html:span epub:type="pagebreak" title="8" class="page-normal"/></html:td></html:tr>
                        <html:tr><html:td>td #4</html:td></html:tr>
                    </html:tbody>
                </html:table>
                <html:div epub:type="pagebreak" title="9" class="page-normal"/>
                <html:div epub:type="pagebreak" title="10" class="page-normal"/>
            </x:expect>
        </x:scenario>-->
    </x:scenario>

    <!-- attlist.table -->
    <x:scenario label="when processing the table element attributes">
        <x:context>
            <dtbook:table align="left" bgcolor="red" border="1" cellpadding="10" cellspacing="20" frame="box" rules="all" summary="SUMMARY" width="50%">
                <dtbook:tr>
                    <dtbook:td>TEXT</dtbook:td>
                </dtbook:tr>
            </dtbook:table>
        </x:context>
        <x:expect label="all the attributes except summary (which becoms a caption paragraph) should be translated to CSS using either the style attribute or classes">
            <html:table id="..." class="table-rules-all table-frame-box" style="border: 1px solid black; width: 50%; border-collapse: separate; border-spacing: 20px;">
                <html:caption>
                    <html:p class="table-summary">SUMMARY</html:p>
                </html:caption>
                <html:tbody>
                    <html:tr>
                        <html:td style="padding: 10px;">TEXT</html:td>
                    </html:tr>
                </html:tbody>
            </html:table>
        </x:expect>
    </x:scenario>

    <!-- caption -->
    <x:scenario label="when processing the caption element">
        <x:scenario label="in the context of a table">
            <x:context>
                <dtbook:table>
                    <dtbook:caption>CAPTION</dtbook:caption>
                </dtbook:table>
            </x:context>
            <x:expect label="the resulting element should be a caption">
                <html:table id="...">
                    <html:caption id="...">CAPTION</html:caption>
                </html:table>
            </x:expect>
        </x:scenario>
        <x:scenario label="in the context of a "/>
    </x:scenario>

    <!-- attlist.caption -->
    <x:scenario label="when processing the caption element attributes">
        <x:context>
            <dtbook:table>
                <dtbook:caption id="caption" imgref="img"><!-- COMMENT --></dtbook:caption>
                <dtbook:tbody>
                    <dtbook:tr>
                        <dtbook:td>
                            <dtbook:img id="img" src="img.jpg"/>
                        </dtbook:td>
                    </dtbook:tr>
                </dtbook:tbody>
            </dtbook:table>
        </x:context>
        <x:expect label="the imgref should be replaced by the longdesc attribute on the corresponding img element.">
            <html:table id="...">
                <html:caption id="caption"><!-- COMMENT --></html:caption>
                <html:tbody>
                    <html:tr>
                        <html:td>
                            <html:img id="img" src="images/img.jpg" longdesc="#caption" alt="image"/>
                        </html:td>
                    </html:tr>
                </html:tbody>
            </html:table>
        </x:expect>
    </x:scenario>

    <!-- thead -->
    <x:scenario label="when processing a thead element">
        <x:context>
            <dtbook:thead>
                <dtbook:tr>
                    <dtbook:td>TEXT</dtbook:td>
                </dtbook:tr>
            </dtbook:thead>
        </x:context>
        <x:expect label="the resulting element should be a thead">
            <html:thead>...</html:thead>
        </x:expect>
    </x:scenario>

    <!-- attlist.thead -->
    <!-- nothing interesting to test. halign and valign tested in attlist.td. -->

    <!-- tfoot -->
    <x:scenario label="when processing a tfoot element">
        <x:context>
            <dtbook:tfoot>
                <dtbook:tr>
                    <dtbook:td>TEXT</dtbook:td>
                </dtbook:tr>
            </dtbook:tfoot>
        </x:context>
        <x:expect label="the resulting element should be a tfoot">
            <html:tfoot>...</html:tfoot>
        </x:expect>
    </x:scenario>

    <!-- attlist.tfoot -->
    <!-- nothing interesting to test. halign and valign tested in attlist.td. -->

    <!-- tbody -->
    <x:scenario label="when processing a tbody element">
        <x:context>
            <dtbook:tbody>
                <dtbook:tr>
                    <dtbook:td>TEXT</dtbook:td>
                </dtbook:tr>
            </dtbook:tbody>
        </x:context>
        <x:expect label="the resulting element should be a tbody">
            <html:tbody>...</html:tbody>
        </x:expect>
    </x:scenario>

    <!-- attlist.tbody -->
    <!-- nothing interesting to test. halign and valign tested in attlist.td. -->

    <!-- colgroup -->
    <x:scenario label="when processing a colgroup element">
        <x:context>
            <dtbook:colgroup><!-- COMMENT --></dtbook:colgroup>
        </x:context>
        <x:expect label="the resulting element should be a colgroup">
            <html:colgroup><!-- COMMENT --></html:colgroup>
        </x:expect>
    </x:scenario>

    <!-- attlist.colgroup -->
    <x:scenario label="when processing the colgroup element attributes">
        <!-- halign and valigh tested in attlist.td -->
        <x:context>
            <dtbook:colgroup span="2" width="10%"><!-- COMMENT --></dtbook:colgroup>
        </x:context>
        <x:expect label="the span attribute should be copied over, while the width attribute should be converted to CSS in the style attribute">
            <html:colgroup span="2" style="width: 10%;"><!-- COMMENT --></html:colgroup>
        </x:expect>
    </x:scenario>

    <!-- col -->
    <x:scenario label="when processing a col element">
        <x:scenario label="which is inside a colgroup">
            <x:context>
                <dtbook:table>
                    <dtbook:colgroup id="abc">
                        <dtbook:col align="center"/>
                    </dtbook:colgroup>
                    <dtbook:tr>
                        <dtbook:td><!-- COMMENT --></dtbook:td>
                    </dtbook:tr>
                </dtbook:table>
            </x:context>
            <x:expect label="the col should remain in the colgroup">
                <html:table id="...">
                    <html:colgroup id="abc">
                        <html:col style="text-align: center;"/>
                    </html:colgroup>
                    <html:tbody>
                        <html:tr>
                            <html:td><!-- COMMENT --></html:td>
                        </html:tr>
                    </html:tbody>
                </html:table>
            </x:expect>
        </x:scenario>
        <x:scenario label="which is not inside a colgroup and does not have a colgroup sibling">
            <x:context>
                <dtbook:table>
                    <dtbook:col/>
                    <dtbook:tr>
                        <dtbook:td><!-- COMMENT --></dtbook:td>
                    </dtbook:tr>
                </dtbook:table>
            </x:context>
            <x:expect label="the col should be wrapped in a colgroup">
                <html:table id="...">
                    <html:colgroup>
                        <html:col/>
                    </html:colgroup>
                    <html:tbody>
                        <html:tr>
                            <html:td><!-- COMMENT --></html:td>
                        </html:tr>
                    </html:tbody>
                </html:table>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.col -->
    <x:scenario label="when processing the col element attributes">
        <!-- halign and valigh tested in attlist.td -->
        <x:context>
            <dtbook:col span="2" width="10%"><!-- COMMENT --></dtbook:col>
        </x:context>
        <x:expect label="the span attribute should be copied over, while the width attribute should be converted to CSS in the style attribute">
            <html:col span="2" style="width: 10%;"><!-- COMMENT --></html:col>
        </x:expect>
    </x:scenario>

    <!-- tr -->
    <x:scenario label="when processing a tr element">
        <x:scenario label="with a tbody parent">
            <x:context>
                <dtbook:table>
                    <dtbook:tbody>
                        <dtbook:tr>
                            <dtbook:td>TEXT</dtbook:td>
                        </dtbook:tr>
                    </dtbook:tbody>
                </dtbook:table>
            </x:context>
            <x:expect label="the resulting element should be a tr with a tbody parent">
                <html:table id="...">
                    <html:tbody>
                        <html:tr>...</html:tr>
                    </html:tbody>
                </html:table>
            </x:expect>
        </x:scenario>
        <x:scenario label="without a tbody parent">
            <x:context>
                <dtbook:table>
                    <dtbook:tr>
                        <dtbook:td>TEXT</dtbook:td>
                    </dtbook:tr>
                    <dtbook:tr>
                        <dtbook:td>TEXT</dtbook:td>
                    </dtbook:tr>
                </dtbook:table>
            </x:context>
            <x:expect label="the resulting tr elements should be wrapped inside a tbody parent">
                <html:table id="...">
                    <html:tbody>
                        <html:tr>...</html:tr>
                        <html:tr>...</html:tr>
                    </html:tbody>
                </html:table>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- attlist.tr -->
    <!-- nothing interesting to test. halign and valign tested in attlist.td. -->

    <!-- th -->
    <x:scenario label="when processing a th element">
        <x:context>
            <dtbook:th>TEXT</dtbook:th>
        </x:context>
        <x:expect label="the resulting element should be a th">
            <html:th>...</html:th>
        </x:expect>
    </x:scenario>

    <!-- attlist.th -->
    <!-- tested in attlist.td -->

    <!-- td -->
    <x:scenario label="when processing a td element">
        <x:context>
            <dtbook:td>TEXT</dtbook:td>
        </x:context>
        <x:expect label="the resulting element should be a td">
            <html:td>...</html:td>
        </x:expect>
    </x:scenario>

    <!-- attlist.td -->
    <x:scenario label="when processing the td element attributes">
        <x:context>
            <dtbook:table>
                <dtbook:thead>
                    <dtbook:th id="id1"><!-- COMMENT 1 --></dtbook:th>
                    <dtbook:th id="id2"><!-- COMMENT 2 --></dtbook:th>
                </dtbook:thead>
                <dtbook:tbody>
                    <dtbook:tr>
                        <dtbook:td abbr="ABBR TEXT" axis="name" headers="id1 id2" scope="col" rowspan="2" colspan="2" align="center" char="." charoff="4" valign="middle">TEXT</dtbook:td>
                    </dtbook:tr>
                </dtbook:tbody>
            </dtbook:table>
        </x:context>
        <x:expect label="the abbr, axis, char and charoff attributes are dropped; the headers, scope, rowspan and colspan attributes are copied, the align and valign attributes are converted to CSS">
            <html:table id="...">
                <html:thead>
                    <html:th id="id1"><!-- COMMENT 1 --></html:th>
                    <html:th id="id2"><!-- COMMENT 2 --></html:th>
                </html:thead>
                <html:tbody>
                    <html:tr>
                        <html:td headers="id1 id2" scope="col" rowspan="2" colspan="2" style="text-align: center; vertical-align: middle;">TEXT</html:td>
                    </html:tr>
                </html:tbody>
            </html:table>
        </x:expect>
    </x:scenario>


    <!-- ########## Nordic tests ########## -->

    <!--
        precedingemptyline class
        discussion: https://github.com/josteinaj/nordic-epub3-dtbook-migrator/issues/2
    -->
    <x:scenario label="when processing a paragraph with a preceding* class">
        <x:scenario label="basic test with class='precedingemptyline'">
            <x:context>
                <dtbook:bodymatter>
                    <dtbook:level1>
                        <dtbook:p>Some text</dtbook:p>
                        <!-- thematic break occurs here -->
                        <dtbook:p class="precedingemptyline">More text</dtbook:p>
                    </dtbook:level1>
                </dtbook:bodymatter>
            </x:context>
            <x:expect label="the html version should add a preceding hr element">
                <html:section id="..." epub:type="bodymatter chapter">
                    <html:p>Some text</html:p>
                    <!-- thematic break occurs here -->
                    <html:hr class="emptyline"/>
                    <html:p>More text</html:p>
                </html:section>
            </x:expect>
        </x:scenario>
        <x:scenario label="somewhat more extensive test with precedingemptyline, precedingseparator, p elements with additional classes and a p without a class at all">
            <x:context>
                <dtbook:p class="precedingemptyline">Paragraph 1</dtbook:p>
                <dtbook:p class="precedingseparator">Paragraph 2</dtbook:p>
                <dtbook:p class="precedingemptyline indented">Paragraph 3</dtbook:p>
                <dtbook:p class="precedingseparator indented">Paragraph 4</dtbook:p>
                <dtbook:p class="indented">Paragraph 5</dtbook:p>
                <dtbook:p>Paragraph 6</dtbook:p>
            </x:context>
            <x:expect label="the resulting p elements should be preceded with hr elements with classes 'emptyline', 'separator', and 'emptyline' respectively">
                <html:hr class="emptyline"/>
                <html:p>Paragraph 1</html:p>
                <html:hr class="separator"/>
                <html:p>Paragraph 2</html:p>
                <html:hr class="emptyline"/>
                <html:p class="indented">Paragraph 3</html:p>
                <html:hr class="separator"/>
                <html:p class="indented">Paragraph 4</html:p>
                <html:p class="indented">Paragraph 5</html:p>
                <html:p>Paragraph 6</html:p>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- a typical toc -->
    <x:scenario label="when processing a typical toc">
        <x:context>
            <dtbook:frontmatter>
                <dtbook:level1>
                    <dtbook:list type="pl" class="toc">
                        <dtbook:li>
                            <dtbook:lic>
                                <dtbook:strong><![CDATA[Kapittel 1 Vitenskap: grunnleggende antakelser]]></dtbook:strong>
                            </dtbook:lic>
                            <dtbook:lic>13</dtbook:lic>
                            <dtbook:list type="pl">
                                <dtbook:li>
                                    <dtbook:lic>Hva er vitenskap?</dtbook:lic>
                                    <dtbook:lic>14</dtbook:lic>
                                </dtbook:li>
                                <dtbook:li>
                                    <dtbook:lic>Psykologi som vitenskap: tre tradisjoner</dtbook:lic>
                                    <dtbook:lic>17</dtbook:lic>
                                </dtbook:li>
                            </dtbook:list>
                        </dtbook:li>
                        <dtbook:li>
                            <dtbook:lic>
                                <dtbook:strong>Del 1 Grunnleggende begreper og prinsipper</dtbook:strong>
                            </dtbook:lic>
                            <dtbook:lic>39</dtbook:lic>
                            <dtbook:list type="pl">
                                <dtbook:li>
                                    <dtbook:lic>
                                        <dtbook:strong><![CDATA[Kapittel 2 Vitenskapelig tenkning: validitet, begreper og teori]]></dtbook:strong>
                                    </dtbook:lic>
                                    <dtbook:lic>41</dtbook:lic>
                                    <dtbook:list type="pl">
                                        <dtbook:li>
                                            <dtbook:lic>Validitet</dtbook:lic>
                                            <dtbook:lic>41</dtbook:lic>
                                        </dtbook:li>
                                        <dtbook:li>
                                            <dtbook:lic>Vitenskapelige begreper</dtbook:lic>
                                            <dtbook:lic>46</dtbook:lic>
                                        </dtbook:li>
                                    </dtbook:list>
                                </dtbook:li>
                                <dtbook:li>
                                    <dtbook:lic>
                                        <dtbook:strong><![CDATA[Kapittel 3 Forskningsprosessen: fra spørsmål til svar]]></dtbook:strong>
                                    </dtbook:lic>
                                    <dtbook:lic>70</dtbook:lic>
                                    <dtbook:list type="pl">
                                        <dtbook:li>
                                            <dtbook:lic>Hvor kommer ideer til forskning fra?</dtbook:lic>
                                            <dtbook:lic>71</dtbook:lic>
                                        </dtbook:li>
                                        <dtbook:li>
                                            <dtbook:lic>Psykologien som empirisk disiplin</dtbook:lic>
                                            <dtbook:lic>75</dtbook:lic>
                                        </dtbook:li>
                                        <dtbook:li>
                                            <dtbook:lic>Logikk i forskning</dtbook:lic>
                                            <dtbook:lic>80</dtbook:lic>
                                        </dtbook:li>
                                        <dtbook:pagenum id="page-8" page="normal">8</dtbook:pagenum>
                                        <dtbook:li>
                                            <dtbook:lic><![CDATA[Ideer til forskning: hypoteser og prediksjoner]]></dtbook:lic>
                                            <dtbook:lic>83</dtbook:lic>
                                        </dtbook:li>
                                    </dtbook:list>
                                </dtbook:li>
                            </dtbook:list>
                        </dtbook:li>
                    </dtbook:list>
                </dtbook:level1>
            </dtbook:frontmatter>
        </x:context>
        <x:expect label="the resulting toc should be as given">
            <html:section epub:type="frontmatter toc" id="...">
                <html:ol id="...">
                    <html:li id="...">
                        <html:span class="lic">
                            <html:strong>Kapittel 1 Vitenskap: grunnleggende antakelser</html:strong>
                        </html:span>
                        <html:span class="lic">13</html:span>
                        <html:ol id="...">
                            <html:li id="...">
                                <html:span class="lic">Hva er vitenskap?</html:span>
                                <html:span class="lic">14</html:span>
                            </html:li>
                            <html:li id="...">
                                <html:span class="lic"><![CDATA[Psykologi som vitenskap: tre tradisjoner]]></html:span>
                                <html:span class="lic">17</html:span>
                            </html:li>
                        </html:ol>
                    </html:li>
                    <html:li id="...">
                        <html:span class="lic">
                            <html:strong>Del 1 Grunnleggende begreper og prinsipper</html:strong>
                        </html:span>
                        <html:span class="lic">39</html:span>
                        <html:ol id="...">
                            <html:li id="...">
                                <html:span class="lic">
                                    <html:strong><![CDATA[Kapittel 2 Vitenskapelig tenkning: validitet, begreper og teori]]></html:strong>
                                </html:span>
                                <html:span class="lic">41</html:span>
                                <html:ol id="...">
                                    <html:li id="...">
                                        <html:span class="lic">Validitet</html:span>
                                        <html:span class="lic">41</html:span>
                                    </html:li>
                                    <html:li id="...">
                                        <html:span class="lic">Vitenskapelige begreper</html:span>
                                        <html:span class="lic">46</html:span>
                                    </html:li>
                                </html:ol>
                            </html:li>
                            <html:li id="...">
                                <html:span class="lic">
                                    <html:strong><![CDATA[Kapittel 3 Forskningsprosessen: fra spørsmål til svar]]></html:strong>
                                </html:span>
                                <html:span class="lic">70</html:span>
                                <html:ol id="...">
                                    <html:li id="...">
                                        <html:span class="lic"><![CDATA[Hvor kommer ideer til forskning fra?]]></html:span>
                                        <html:span class="lic">71</html:span>
                                    </html:li>
                                    <html:li id="...">
                                        <html:span class="lic"><![CDATA[Psykologien som empirisk disiplin]]></html:span>
                                        <html:span class="lic">75</html:span>
                                    </html:li>
                                    <html:li id="...">
                                        <html:span class="lic">Logikk i forskning</html:span>
                                        <html:span class="lic">80</html:span>
                                        <html:span epub:type="pagebreak" id="page-8" class="page-normal" title="8"/>
                                    </html:li>
                                    <html:li id="...">
                                        <html:span class="lic"><![CDATA[Ideer til forskning: hypoteser og prediksjoner]]></html:span>
                                        <html:span class="lic">83</html:span>
                                    </html:li>
                                </html:ol>
                            </html:li>
                        </html:ol>
                    </html:li>
                </html:ol>
            </html:section>
        </x:expect>
    </x:scenario>

    <!-- cover -->
    <x:scenario label="when processing a level1 with class 'cover' in frontmatter">
        <x:scenario label="with only a paragraph">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:level1 class="cover">
                            <dtbook:p/>
                        </dtbook:level1>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the resulting element should be a section with epub:type cover">
                <html:body>
                    <html:section id="..." epub:type="cover">
                        <html:p/>
                    </html:section>
                </html:body>
            </x:expect>
        </x:scenario>
        <x:scenario label="with no headline but with asides with epub:type 'z3998:production' for the covers and flaps">
            <x:context>
                <dtbook:book>
                    <dtbook:frontmatter>
                        <dtbook:level1 class="cover">
                            <dtbook:prodnote class="frontcover" render="optional"/>
                            <dtbook:prodnote class="rearcover" render="optional"/>
                            <dtbook:prodnote class="leftflap" render="optional"/>
                            <dtbook:prodnote class="rightflap" render="optional"/>
                        </dtbook:level1>
                    </dtbook:frontmatter>
                </dtbook:book>
            </x:context>
            <x:expect label="the resulting element should be a level1 inside the frontmatter">
                <html:body>
                    <html:section id="..." epub:type="cover">
                        <html:section id="..." class="render-optional frontcover"/>
                        <html:section id="..." class="render-optional rearcover"/>
                        <html:section id="..." class="render-optional leftflap"/>
                        <html:section id="..." class="render-optional rightflap"/>
                    </html:section>
                </html:body>
            </x:expect>
        </x:scenario>
    </x:scenario>

    <!-- #### From MTMs DTBook schema #### -->

    <!-- TODO: go through MTM-schema and add corresponding XSpec tests here where applicable -->


    <!-- ########## Regression tests ########## -->

    <x:scenario label="when encountering a imggroup within a p">
        <x:context>
            <dtbook:div>
                <dtbook:p xml:lang="no" id="id1" class="class1">
                    <dtbook:imggroup>
                        <dtbook:img id="rId101" src="900340%20(Reparert)-Picture%201.png" alt=""/>
                    </dtbook:imggroup>
                </dtbook:p>
                <dtbook:p xml:lang="no" id="id2" class="class2">
                    <dtbook:img id="rId101" src="900340%20(Reparert)-Picture%201.png" alt=""/>
                </dtbook:p>
                <dtbook:p xml:lang="no" id="id3" class="class3">TEXT<dtbook:imggroup>
                        <dtbook:img id="rId101" src="900340%20(Reparert)-Picture%201.png" alt=""/>
                    </dtbook:imggroup>TEXT</dtbook:p>
            </dtbook:div>
        </x:context>
        <x:expect label="the p should be converted into a div and any text before and after the imggroup should be wrapped in new p elements (img without imggroup is allowed in p)">
            <html:div>
                <html:div xml:lang="no" lang="no" id="id1" class="class1">
                    <html:figure id="..." class="image">
                        <html:img id="rId101" src="images/900340%20(Reparert)-Picture%201.png" alt=""/>
                    </html:figure>
                </html:div>
                <html:p xml:lang="no" lang="no" id="id2" class="class2">
                    <html:img id="rId101" src="images/900340%20(Reparert)-Picture%201.png" alt=""/>
                </html:p>
                <html:div xml:lang="no" lang="no" id="id3" class="class3">
                    <html:p>TEXT</html:p>
                    <html:figure id="..." class="image">
                        <html:img id="rId101" src="images/900340%20(Reparert)-Picture%201.png" alt=""/>
                    </html:figure>
                    <html:p>TEXT</html:p>
                </html:div>
            </html:div>
        </x:expect>
    </x:scenario>

    <x:scenario label="when processing a li element enumerated with letters of with a string length &gt; 1">
        <x:context>
            <dtbook:list type="pl" depth="1">
                <dtbook:li>aa. ONE</dtbook:li>
                <dtbook:li>bbb. TWO</dtbook:li>
            </dtbook:list>
        </x:context>
        <x:expect label="the letters should be correctly parsed">
            <html:ol id="..." type="a" class="preformatted">
                <html:li id="..." value="27">ONE</html:li>
                <html:li id="..." value="1406">TWO</html:li>
            </html:ol>
        </x:expect>
    </x:scenario>

    <x:scenario label="Move table pagebreak to first cell in following row. #113">
        <x:context>
            <dtbook:table>
                <dtbook:pagenum page="normal">1</dtbook:pagenum>
                <dtbook:pagenum page="normal">2</dtbook:pagenum>
                <dtbook:tr>
                    <dtbook:td><dtbook:span>cell 11</dtbook:span></dtbook:td>
                    <dtbook:td><dtbook:span>cell 12</dtbook:span></dtbook:td>
                    <dtbook:td><dtbook:span>cell 13</dtbook:span></dtbook:td>
                </dtbook:tr>
                <dtbook:pagenum page="normal">3</dtbook:pagenum>
                <dtbook:pagenum page="normal">4</dtbook:pagenum>
                <dtbook:tr>
                    <dtbook:td><dtbook:span>cell 21</dtbook:span></dtbook:td>
                    <dtbook:td><dtbook:span>cell 22</dtbook:span></dtbook:td>
                    <dtbook:td><dtbook:span>cell 23</dtbook:span></dtbook:td>
                </dtbook:tr>
                <dtbook:pagenum page="normal">5</dtbook:pagenum>
                <dtbook:pagenum page="normal">6</dtbook:pagenum>
                <dtbook:tr>
                    <dtbook:td><dtbook:span>cell 31</dtbook:span></dtbook:td>
                    <dtbook:td><dtbook:span>cell 32</dtbook:span></dtbook:td>
                    <dtbook:td><dtbook:span>cell 33</dtbook:span></dtbook:td>
                </dtbook:tr>
                <dtbook:pagenum page="normal">7</dtbook:pagenum>
                <dtbook:pagenum page="normal">8</dtbook:pagenum>
            </dtbook:table>
        </x:context>
        <x:expect label="table pagebreak should be moved to first cell in following row or before the table if in the beginning of the table">
            <html:div epub:type="pagebreak" title="1" class="page-normal"/>
            <html:div epub:type="pagebreak" title="2" class="page-normal"/>
            <html:table id="...">
                <html:tbody>
                    <html:tr>
                        <html:td><html:span>cell 11</html:span></html:td>
                        <html:td><html:span>cell 12</html:span></html:td>
                        <html:td><html:span>cell 13</html:span></html:td>
                    </html:tr>
                    <html:tr>
                        <html:td>
                            <html:span epub:type="pagebreak" title="3" class="page-normal"/>
                            <html:span epub:type="pagebreak" title="4" class="page-normal"/>
                            <html:span>cell 21</html:span>
                        </html:td>
                        <html:td><html:span>cell 22</html:span></html:td>
                        <html:td><html:span>cell 23</html:span></html:td>
                    </html:tr>
                    <html:tr>
                        <html:td>
                            <html:span epub:type="pagebreak" title="5" class="page-normal"/>
                            <html:span epub:type="pagebreak" title="6" class="page-normal"/>
                            <html:span>cell 31</html:span>
                        </html:td>
                        <html:td><html:span>cell 32</html:span></html:td>
                        <html:td><html:span>cell 33</html:span></html:td>
                    </html:tr>
                </html:tbody>
            </html:table>
            <html:div epub:type="pagebreak" title="7" class="page-normal"/>
            <html:div epub:type="pagebreak" title="8" class="page-normal"/>
        </x:expect>
    </x:scenario>

    <x:scenario label="Make sure the p class 'indented' is preserved during conversion to DTBook #73">
        <x:context>
            <dtbook:p class="indented"/>
        </x:context>
        <x:expect label="the p class 'indented' should be preserved">
            <html:p class="indented"/>
        </x:expect>
    </x:scenario>

    <x:scenario label="Make sure the span class 'asciimath' is preserved during conversion to DTBook #54">
        <x:context>
            <dtbook:span class="asciimath"/>
        </x:context>
        <x:expect label="the span class 'asciimath' should be preserved">
            <html:span class="asciimath"/>
        </x:expect>
    </x:scenario>

    <x:scenario label="List items with both inline and imggroup content, and no bullets or numbering">
        <x:context>
            <dtbook:list type="pl">
                <dtbook:li><dtbook:strong>Totalt antal häckande par</dtbook:strong> 49 024 037–101 782 306</dtbook:li>
                <dtbook:li><dtbook:strong>Antal ökande arter</dtbook:strong> 64</dtbook:li>
                <dtbook:li><dtbook:strong>Procentandel ökande arter</dtbook:strong> 26%</dtbook:li>
                <dtbook:li><dtbook:strong>Antal minskande arter</dtbook:strong> 114</dtbook:li>
                <dtbook:li><dtbook:strong>Procentandel minskande arter</dtbook:strong> 46%</dtbook:li>
                <dtbook:li><dtbook:strong>Sommarhalvåret</dtbook:strong>
                    <dtbook:imggroup>
                        <dtbook:img src="img01.jpg" alt="illustration"/>
                    </dtbook:imggroup> (vissa arter kan sällsynt övervintra)</dtbook:li>
                <dtbook:li><dtbook:strong>Hela året</dtbook:strong>
                    <dtbook:imggroup>
                        <dtbook:img src="img02.jpg" alt="illustration"/>
                    </dtbook:imggroup></dtbook:li>
                <dtbook:li><dtbook:strong>Vinterhalvåret</dtbook:strong>
                    <dtbook:imggroup>
                        <dtbook:img src="img03.jpg" alt="illustration"/>
                    </dtbook:imggroup></dtbook:li>
                <dtbook:li><dtbook:strong>ökande bestånd</dtbook:strong> ↗</dtbook:li>
                <dtbook:li><dtbook:strong>minskande bestånd</dtbook:strong> ↘</dtbook:li>
                <dtbook:li><dtbook:strong>stabilt bestånd</dtbook:strong> →</dtbook:li>
                <dtbook:li><dtbook:strong>fluktuerande bestånd</dtbook:strong> ~</dtbook:li>
                <dtbook:li><dtbook:strong>beståndsutveckling osäker</dtbook:strong>‽</dtbook:li>
            </dtbook:list>
        </x:context>
        <x:expect label="the result should be as expected">
            <html:ol id="..." class="list-style-type-none preformatted">
                <html:li id="..."><html:strong>Totalt antal häckande par</html:strong> 49 024 037–101 782 306</html:li>
                <html:li id="..."><html:strong>Antal ökande arter</html:strong> 64</html:li>
                <html:li id="..."><html:strong>Procentandel ökande arter</html:strong> 26%</html:li>
                <html:li id="..."><html:strong>Antal minskande arter</html:strong> 114</html:li>
                <html:li id="..."><html:strong>Procentandel minskande arter</html:strong> 46%</html:li>
                <html:li id="...">
                    <html:strong>Sommarhalvåret</html:strong>
                    <html:figure id="..." class="image">
                        <html:img id="..." src="images/img01.jpg" alt="illustration"/>
                    </html:figure> (vissa arter kan sällsynt övervintra)</html:li>
                <html:li id="...">
                    <html:strong>Hela året</html:strong>
                    <html:figure id="..." class="image">
                        <html:img id="..." src="images/img02.jpg" alt="illustration"/>
                    </html:figure>
                </html:li>
                <html:li id="...">
                    <html:strong>Vinterhalvåret</html:strong>
                    <html:figure id="..." class="image">
                        <html:img id="..." src="images/img03.jpg" alt="illustration"/>
                    </html:figure>
                </html:li>
                <html:li id="..."><html:strong>ökande bestånd</html:strong> ↗</html:li>
                <html:li id="..."><html:strong>minskande bestånd</html:strong> ↘</html:li>
                <html:li id="..."><html:strong>stabilt bestånd</html:strong> →</html:li>
                <html:li id="..."><html:strong>fluktuerande bestånd</html:strong> ~</html:li>
                <html:li id="..."><html:strong>beståndsutveckling osäker</html:strong>‽</html:li>
            </html:ol>
        </x:expect>
    </x:scenario>

    <x:scenario label="allow lic to be wrapped in a (issue #129)">
        <x:context>
            <dtbook:list type="pl" depth="1">
                <dtbook:li>
                    <dtbook:lic>
                        <dtbook:a href="mtm06350-1.xhtml#d130172e14" id="id1">Chapter 1</dtbook:a>
                    </dtbook:lic>
                    <dtbook:lic>
                        <dtbook:a href="mtm06350-1.xhtml#d130172e14" id="id1_1">1</dtbook:a>
                    </dtbook:lic>
                </dtbook:li>
                <dtbook:li>
                    <dtbook:lic>
                        <dtbook:a href="mtm06350-1.xhtml#d130172e14" id="id2">Chapter 2</dtbook:a>
                    </dtbook:lic>
                    <dtbook:lic>
                        <dtbook:a href="mtm06350-1.xhtml#d130172e14">2</dtbook:a>
                    </dtbook:lic>
                    <dtbook:list type="pl" depth="2">
                        <dtbook:li>
                            <dtbook:lic>Chapter 2.1</dtbook:lic>
                            <dtbook:lic>3</dtbook:lic>
                        </dtbook:li>
                    </dtbook:list>
                </dtbook:li>
                <dtbook:li>
                    <dtbook:lic>
                        <dtbook:a href="mtm06350-1.xhtml#d130172e14" id="id3">Chapter 3</dtbook:a>
                    </dtbook:lic>
                    <dtbook:span>non-lic</dtbook:span>
                    <dtbook:span>span</dtbook:span>
                </dtbook:li>
                <dtbook:li>
                    <dtbook:lic>
                        <dtbook:a href="mtm06350-1.xhtml#d130172e14" id="id4">Chapter 4</dtbook:a>
                    </dtbook:lic>
                    <dtbook:span>non-lic</dtbook:span>
                    <dtbook:span>span</dtbook:span>
                    <dtbook:list type="pl" depth="2">
                        <dtbook:li>
                            <dtbook:lic>Chapter 4.1</dtbook:lic>
                            <dtbook:lic>4</dtbook:lic>
                        </dtbook:li>
                    </dtbook:list>
                </dtbook:li>
            </dtbook:list>
        </x:context>
        <x:expect label="the lic elements should be direct children of li and the a should become spans inside the lics">
            <html:ol class="list-style-type-none preformatted" id="...">
                <html:li id="...">
                    <html:span class="lic">
                        <html:a id="id1" href="mtm06350-1.xhtml#d130172e14">Chapter 1</html:a>
                    </html:span>
                    <html:span class="lic">
                        <html:a id="id1_1" href="mtm06350-1.xhtml#d130172e14">1</html:a>
                    </html:span>
                </html:li>
                <html:li id="...">
                    <html:span class="lic">
                        <html:a id="id2" href="mtm06350-1.xhtml#d130172e14">Chapter 2</html:a>
                    </html:span>
                    <html:span class="lic">
                        <html:a href="mtm06350-1.xhtml#d130172e14" id="...">2</html:a>
                    </html:span>
                    <html:ol class="list-style-type-none preformatted" id="...">
                        <html:li id="...">
                            <html:span class="lic">Chapter 2.1</html:span>
                            <html:span class="lic">3</html:span>
                        </html:li>
                    </html:ol>
                </html:li>
                <html:li id="...">
                    <html:span class="lic">
                        <html:a href="mtm06350-1.xhtml#d130172e14" id="id3">Chapter 3</html:a>
                    </html:span>
                    <html:span>non-lic</html:span>
                    <html:span>span</html:span>
                </html:li>
                <html:li id="...">
                    <html:span class="lic">
                        <html:a id="id4" href="mtm06350-1.xhtml#d130172e14">Chapter 4</html:a>
                    </html:span>
                    <html:span>non-lic</html:span>
                    <html:span>span</html:span>
                    <html:ol class="list-style-type-none preformatted" id="...">
                        <html:li id="...">
                            <html:span class="lic">Chapter 4.1</html:span>
                            <html:span class="lic">4</html:span>
                        </html:li>
                    </html:ol>
                </html:li>
            </html:ol>
        </x:expect>
    </x:scenario>

    <x:scenario label="pagebreaks in imggroups should become divs">
        <x:context>
            <dtbook:imggroup>
                <dtbook:img id="img1" src="img.jpg"/>
                <dtbook:pagenum>1</dtbook:pagenum>
            </dtbook:imggroup>
        </x:context>
        <x:expect label="the pagebreaks should have become a div">
            <html:figure class="image" id="...">
                <html:img id="img1" src="images/img.jpg" alt="image"/>
                <html:div epub:type="pagebreak" class="page-normal" title="1"/>
            </html:figure>
        </x:expect>
    </x:scenario>

    <x:scenario label="rearnotes and footnotes">
        <x:context>
            <dtbook:book>
                <dtbook:frontmatter>
                    <dtbook:level1 id="frontmatter-notes">
                        <dtbook:h1>notes</dtbook:h1>
                        <dtbook:note id="fn_ch1_1">
                            <dtbook:p>1. G.D.H. Cole in Horowitz, <dtbook:em>The Anarchists</dtbook:em> (New York: Dell Publishing, 1964).</dtbook:p>
                        </dtbook:note>
                        <dtbook:note id="fn_ch1_2">
                            <dtbook:p>2. G. Woodcock, <dtbook:em>Anarchism</dtbook:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</dtbook:p>
                        </dtbook:note>
                        <dtbook:pagenum page="normal" id="page-40">40</dtbook:pagenum>
                        <dtbook:note id="fn_ch1_3">
                            <dtbook:p>3. <dtbook:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</dtbook:em> at http://colet.uhicago.edu/cgi-bin</dtbook:p>
                        </dtbook:note>
                    </dtbook:level1>
                </dtbook:frontmatter>
                <dtbook:bodymatter>
                    <dtbook:level1 id="rearnotes">
                        <dtbook:h1>notes</dtbook:h1>
                        <dtbook:pagenum page="normal" id="page-39">39</dtbook:pagenum>
                        <dtbook:note id="fn_ch1_1">
                            <dtbook:p>1. G.D.H. Cole in Horowitz, <dtbook:em>The Anarchists</dtbook:em> (New York: Dell Publishing, 1964).</dtbook:p>
                        </dtbook:note>
                        <dtbook:note id="fn_ch1_2">
                            <dtbook:p>2. G. Woodcock, <dtbook:em>Anarchism</dtbook:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</dtbook:p>
                        </dtbook:note>
                        <dtbook:pagenum page="normal" id="page-40">40</dtbook:pagenum>
                        <dtbook:note id="fn_ch1_3">
                            <dtbook:p>3. <dtbook:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</dtbook:em> at http://colet.uhicago.edu/cgi-bin</dtbook:p>
                        </dtbook:note>
                        <dtbook:pagenum page="normal" id="page-41">41</dtbook:pagenum>
                        <dtbook:p>Paragraph</dtbook:p>
                        <dtbook:note id="fn_ch1_3_2">
                            <dtbook:p>3. <dtbook:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</dtbook:em> at http://colet.uhicago.edu/cgi-bin</dtbook:p>
                        </dtbook:note>
                        <dtbook:pagenum page="normal" id="page-42">42</dtbook:pagenum>
                    </dtbook:level1>
                    <dtbook:level1 id="bodymatter-notes">
                        <dtbook:h1>notes</dtbook:h1>
                        <dtbook:div>
                            <dtbook:note id="fn_ch1_1">
                                <dtbook:p>1. G.D.H. Cole in Horowitz, <dtbook:em>The Anarchists</dtbook:em> (New York: Dell Publishing, 1964).</dtbook:p>
                            </dtbook:note>
                            <dtbook:note id="fn_ch1_2">
                                <dtbook:p>2. G. Woodcock, <dtbook:em>Anarchism</dtbook:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</dtbook:p>
                            </dtbook:note>
                            <dtbook:pagenum page="normal" id="page-40">40</dtbook:pagenum>
                            <dtbook:note id="fn_ch1_3">
                                <dtbook:p>3. <dtbook:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</dtbook:em> at http://colet.uhicago.edu/cgi-bin</dtbook:p>
                            </dtbook:note>
                        </dtbook:div>
                    </dtbook:level1>
                    <dtbook:level1 id="chapter-with-rearnotes">
                        <dtbook:h1>Chapter with rearnotes</dtbook:h1>
                        <dtbook:p>Paragraph</dtbook:p>
                        <dtbook:level2 id="rearnotes">
                            <dtbook:h2>notes</dtbook:h2>
                            <dtbook:note id="fn_ch1_1">
                                <dtbook:p>1. G.D.H. Cole in Horowitz, <dtbook:em>The Anarchists</dtbook:em> (New York: Dell Publishing, 1964).</dtbook:p>
                            </dtbook:note>
                            <dtbook:note id="fn_ch1_2">
                                <dtbook:p>2. G. Woodcock, <dtbook:em>Anarchism</dtbook:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</dtbook:p>
                            </dtbook:note>
                            <dtbook:pagenum page="normal" id="page-40">40</dtbook:pagenum>
                            <dtbook:note id="fn_ch1_3">
                                <dtbook:p>3. <dtbook:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</dtbook:em> at http://colet.uhicago.edu/cgi-bin</dtbook:p>
                            </dtbook:note>
                        </dtbook:level2>
                    </dtbook:level1>
                </dtbook:bodymatter>
                <dtbook:rearmatter>
                    <dtbook:level1 id="footnotes">
                        <dtbook:h1>notes</dtbook:h1>
                        <dtbook:note id="fn_ch1_1">
                            <dtbook:p>1. G.D.H. Cole in Horowitz, <dtbook:em>The Anarchists</dtbook:em> (New York: Dell Publishing, 1964).</dtbook:p>
                        </dtbook:note>
                        <dtbook:note id="fn_ch1_2">
                            <dtbook:p>2. G. Woodcock, <dtbook:em>Anarchism</dtbook:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</dtbook:p>
                        </dtbook:note>
                        <dtbook:pagenum page="normal" id="page-40">40</dtbook:pagenum>
                        <dtbook:note id="fn_ch1_3">
                            <dtbook:p>3. <dtbook:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</dtbook:em> at http://colet.uhicago.edu/cgi-bin</dtbook:p>
                        </dtbook:note>
                    </dtbook:level1>
                    <dtbook:level1 id="rearmatter-notes">
                        <dtbook:h1>notes</dtbook:h1>
                        <dtbook:level2>
                            <dtbook:h2>notes</dtbook:h2>
                            <dtbook:note id="fn_ch1_1">
                                <dtbook:p>1. G.D.H. Cole in Horowitz, <dtbook:em>The Anarchists</dtbook:em> (New York: Dell Publishing, 1964).</dtbook:p>
                            </dtbook:note>
                            <dtbook:note id="fn_ch1_2">
                                <dtbook:p>2. G. Woodcock, <dtbook:em>Anarchism</dtbook:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</dtbook:p>
                            </dtbook:note>
                            <dtbook:pagenum page="normal" id="page-40">40</dtbook:pagenum>
                            <dtbook:note id="fn_ch1_3">
                                <dtbook:p>3. <dtbook:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</dtbook:em> at http://colet.uhicago.edu/cgi-bin</dtbook:p>
                            </dtbook:note>
                            <dtbook:div>
                                <dtbook:note id="fn_ch1_1">
                                    <dtbook:p>1. G.D.H. Cole in Horowitz, <dtbook:em>The Anarchists</dtbook:em> (New York: Dell Publishing, 1964).</dtbook:p>
                                </dtbook:note>
                            </dtbook:div>
                        </dtbook:level2>
                    </dtbook:level1>
                </dtbook:rearmatter>
            </dtbook:book>
        </x:context>
        <x:expect label="rearnotes and footnotes should become lists">
            <html:body>
                <html:section epub:type="frontmatter" id="frontmatter-notes">
                    <html:h1 id="...">notes</html:h1>
                    <html:aside epub:type="note" class="notebody" id="fn_ch1_1">
                        <html:p>1. G.D.H. Cole in Horowitz, <html:em>The Anarchists</html:em> (New York: Dell Publishing, 1964).</html:p>
                    </html:aside>
                    <html:aside epub:type="note" class="notebody" id="fn_ch1_2">
                        <html:p>2. G. Woodcock, <html:em>Anarchism</html:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</html:p>
                    </html:aside>
                    <html:div epub:type="pagebreak" class="page-normal" id="page-40" title="40"/>
                    <html:aside epub:type="note" class="notebody" id="fn_ch1_3">
                        <html:p>3. <html:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</html:em> at http://colet.uhicago.edu/cgi-bin</html:p>
                    </html:aside>
                </html:section>
                <html:section epub:type="bodymatter rearnotes" id="rearnotes">
                    <html:h1 id="...">notes</html:h1>
                    <html:div id="page-39" class="page-normal" epub:type="pagebreak" title="39"/>
                    <html:ol epub:type="rearnotes">
                        <html:li epub:type="rearnote" class="notebody" id="fn_ch1_1">
                            <html:p>1. G.D.H. Cole in Horowitz, <html:em>The Anarchists</html:em> (New York: Dell Publishing, 1964).</html:p>
                        </html:li>
                        <html:li epub:type="rearnote" class="notebody" id="fn_ch1_2">
                            <html:p>2. G. Woodcock, <html:em>Anarchism</html:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</html:p>
                            <html:div epub:type="pagebreak" class="page-normal" id="page-40" title="40"/>
                        </html:li>
                        <html:li epub:type="rearnote" class="notebody" id="fn_ch1_3">
                            <html:p>3. <html:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</html:em> at http://colet.uhicago.edu/cgi-bin</html:p>
                        </html:li>
                    </html:ol>
                    <html:div id="page-41" class="page-normal" epub:type="pagebreak" title="41"/>
                    <html:p>Paragraph</html:p>
                    <html:ol epub:type="rearnotes">
                        <html:li epub:type="rearnote" class="notebody" id="fn_ch1_3_2">
                            <html:p>3. <html:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</html:em> at http://colet.uhicago.edu/cgi-bin</html:p>
                        </html:li>
                    </html:ol>
                    <html:div id="page-42" class="page-normal" epub:type="pagebreak" title="42"/>
                </html:section>
                <html:section epub:type="bodymatter chapter" id="bodymatter-notes">
                    <html:h1 id="...">notes</html:h1>
                    <html:div>
                        <html:aside epub:type="note" class="notebody" id="fn_ch1_1">
                            <html:p>1. G.D.H. Cole in Horowitz, <html:em>The Anarchists</html:em> (New York: Dell Publishing, 1964).</html:p>
                        </html:aside>
                        <html:aside epub:type="note" class="notebody" id="fn_ch1_2">
                            <html:p>2. G. Woodcock, <html:em>Anarchism</html:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</html:p>
                        </html:aside>
                        <html:div epub:type="pagebreak" class="page-normal" id="page-40" title="40"/>
                        <html:aside epub:type="note" class="notebody" id="fn_ch1_3">
                            <html:p>3. <html:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</html:em> at http://colet.uhicago.edu/cgi-bin</html:p>
                        </html:aside>
                    </html:div>
                </html:section>
                <html:section epub:type="bodymatter chapter" id="chapter-with-rearnotes">
                    <html:h1 id="...">Chapter with rearnotes</html:h1>
                    <html:p>Paragraph</html:p>
                    <html:section epub:type="rearnotes" id="rearnotes">
                        <html:h2 id="...">notes</html:h2>
                        <html:ol epub:type="rearnotes">
                            <html:li epub:type="rearnote" class="notebody" id="fn_ch1_1">
                                <html:p>1. G.D.H. Cole in Horowitz, <html:em>The Anarchists</html:em> (New York: Dell Publishing, 1964).</html:p>
                            </html:li>
                            <html:li epub:type="rearnote" class="notebody" id="fn_ch1_2">
                                <html:p>2. G. Woodcock, <html:em>Anarchism</html:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</html:p>
                                <html:div epub:type="pagebreak" class="page-normal" id="page-40" title="40"/>
                            </html:li>
                            <html:li epub:type="rearnote" class="notebody" id="fn_ch1_3">
                                <html:p>3. <html:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</html:em> at http://colet.uhicago.edu/cgi-bin</html:p>
                            </html:li>
                        </html:ol>
                    </html:section>
                </html:section>
                <html:section epub:type="backmatter footnotes" id="footnotes">
                    <html:h1 id="...">notes</html:h1>
                    <html:ol epub:type="footnotes">
                        <html:li epub:type="footnote" class="notebody" id="fn_ch1_1">
                            <html:p>1. G.D.H. Cole in Horowitz, <html:em>The Anarchists</html:em> (New York: Dell Publishing, 1964).</html:p>
                        </html:li>
                        <html:li epub:type="footnote" class="notebody" id="fn_ch1_2">
                            <html:p>2. G. Woodcock, <html:em>Anarchism</html:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</html:p>
                            <html:div epub:type="pagebreak" class="page-normal" id="page-40" title="40"/>
                        </html:li>
                        <html:li epub:type="footnote" class="notebody" id="fn_ch1_3">
                            <html:p>3. <html:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</html:em> at http://colet.uhicago.edu/cgi-bin</html:p>
                        </html:li>
                    </html:ol>
                </html:section>
                <html:section epub:type="backmatter" id="rearmatter-notes">
                    <html:h1 id="...">notes</html:h1>
                    <html:section epub:type="footnotes" id="...">
                        <html:h2 id="...">notes</html:h2>
                        <html:ol epub:type="footnotes">
                            <html:li epub:type="footnote" class="notebody" id="fn_ch1_1">
                                <html:p>1. G.D.H. Cole in Horowitz, <html:em>The Anarchists</html:em> (New York: Dell Publishing, 1964).</html:p>
                            </html:li>
                            <html:li epub:type="footnote" class="notebody" id="fn_ch1_2">
                                <html:p>2. G. Woodcock, <html:em>Anarchism</html:em> (Harmondsworth: Penguin, 1979), 8&#x2013;9.</html:p>
                                <html:div epub:type="pagebreak" class="page-normal" id="page-40" title="40"/>
                            </html:li>
                            <html:li epub:type="footnote" class="notebody" id="fn_ch1_3">
                                <html:p>3. <html:em>Dictionnaire de L Acad&#x00E9;mie Fran&#x00E7;aise</html:em> at http://colet.uhicago.edu/cgi-bin</html:p>
                            </html:li>
                        </html:ol>
                        <html:div>
                            <html:aside epub:type="note" class="notebody" id="fn_ch1_1">
                                <html:p>1. G.D.H. Cole in Horowitz, <html:em>The Anarchists</html:em> (New York: Dell Publishing, 1964).</html:p>
                            </html:aside>
                        </html:div>
                    </html:section>
                </html:section>
            </html:body>
        </x:expect>
    </x:scenario>

    <x:scenario label="issue when converting toc #204">
        <x:context>
            <dtbook:frontmatter>
                <dtbook:level1 class="toc">
                    <dtbook:list type="pl"/>
                </dtbook:level1>
                <dtbook:level1>
                    <dtbook:list type="pl" class="toc"/>
                </dtbook:level1>
            </dtbook:frontmatter>
            <dtbook:bodymatter>
                <dtbook:level1 class="toc">
                    <dtbook:list type="pl"/>
                </dtbook:level1>
                <dtbook:level1>
                    <dtbook:list type="pl" class="toc"/>
                </dtbook:level1>
            </dtbook:bodymatter>
            <dtbook:rearmatter>
                <dtbook:level1 class="toc">
                    <dtbook:list type="pl"/>
                </dtbook:level1>
                <dtbook:level1>
                    <dtbook:list type="pl" class="toc"/>
                </dtbook:level1>
            </dtbook:rearmatter>
        </x:context>
        <x:expect label="all the tocs should be converted and placed in the matter they occured in the DTBook">
            <html:section epub:type="frontmatter toc" id="...">
                <html:ol class="list-style-type-none preformatted" id="..."/>
            </html:section>
            <html:section epub:type="frontmatter toc" id="...">
                <html:ol id="..."/>
            </html:section>
            <html:section epub:type="bodymatter toc" id="...">
                <html:ol class="list-style-type-none preformatted" id="..."/>
            </html:section>
            <html:section epub:type="bodymatter toc" id="...">
                <html:ol id="..."/>
            </html:section>
            <html:section epub:type="backmatter toc" id="...">
                <html:ol class="list-style-type-none preformatted" id="..."/>
            </html:section>
            <html:section epub:type="backmatter toc" id="...">
                <html:ol id="..."/>
            </html:section>
        </x:expect>
    </x:scenario>

    <x:scenario label="a p element with code children">
        <x:context xml:space="preserve">
            <dtbook:p xml:space="preserve"/>
            <dtbook:p xml:space="preserve"><dtbook:code/></dtbook:p>
            <dtbook:p xml:space="preserve">TEXT<dtbook:code/>TEXT</dtbook:p>
            <dtbook:p xml:space="preserve">
                <dtbook:code/>
                <dtbook:code/>
            </dtbook:p>
            <dtbook:p xml:space="preserve"><dtbook:code>  preserve  whitespace  </dtbook:code></dtbook:p>
            <dtbook:p><dtbook:code>  preserve  whitespace  </dtbook:code></dtbook:p>
        </x:context>
        <x:expect xml:space="preserve" label="should map to a pre element if it has a xml:space='preserve' attribute
                                              and contains exactly one code child and nothing else">
            <html:p xml:space="preserve"/>
            <html:pre><html:code/></html:pre>
            <html:p xml:space="preserve">TEXT<html:code/>TEXT</html:p>
            <html:p xml:space="preserve">
                <html:code/>
                <html:code/>
            </html:p>
            <html:pre><html:code>  preserve  whitespace  </html:code></html:pre>
            <html:p><html:code>  preserve  whitespace  </html:code></html:p>
        </x:expect>
    </x:scenario>

    <x:scenario label="notes linked to from a table are table notes and should not be treated as rearnotes">
        <x:context>
            <dtbook:book>
                <dtbook:bodymatter>
                    <dtbook:level1>
                        <dtbook:h1>Food</dtbook:h1>
                        <dtbook:p>Let's discuss food.</dtbook:p>
                        <dtbook:level2>
                            <dtbook:h2>Carrots and potatoes</dtbook:h2>
                            <dtbook:p>The table below discusses tastefulness of potatoes and carrots.</dtbook:p>
                            <dtbook:table>
                                <dtbook:tr>
                                    <dtbook:th>Carrots</dtbook:th>
                                    <dtbook:th>Potatoes</dtbook:th>
                                </dtbook:tr>
                                <dtbook:tr>
                                    <dtbook:td colspan="2">Carrots taste better than potatoes depending on the meal it's part of.<dtbook:noteref idref="#tablenote">*</dtbook:noteref></dtbook:td>
                                </dtbook:tr>
                            </dtbook:table>
                            <dtbook:note id="tablenote">
                                <!-- table note -->
                                <dtbook:p>* Carrot vs Potato study, 2014</dtbook:p>
                            </dtbook:note>
                            <dtbook:p>Observations were recorded. Conclusions were made.</dtbook:p>
                        </dtbook:level2>
                    </dtbook:level1>
                </dtbook:bodymatter>
            </dtbook:book>
        </x:context>
        <x:expect label="table notes should remain in place, rearnotes should be moved to new top-level section (i.e. new document)">
            <html:body>
                <html:section epub:type="bodymatter chapter" id="...">
                    <html:h1 id="...">Food</html:h1>
                    <html:p>Let's discuss food.</html:p>
                    <html:section id="...">
                        <html:h2 id="...">Carrots and potatoes</html:h2>
                        <html:p>The table below discusses tastefulness of potatoes and carrots.</html:p>
                        <html:table id="...">
                            <html:tbody>
                                <html:tr>
                                    <html:th>Carrots</html:th>
                                    <html:th>Potatoes</html:th>
                                </html:tr>
                                <html:tr>
                                    <html:td colspan="2">Carrots taste better than potatoes depending on the meal it's part of.<html:a id="..." epub:type="noteref" class="noteref" href="#tablenote"
                                            >*</html:a></html:td>
                                </html:tr>
                            </html:tbody>
                        </html:table>
                        <html:aside id="tablenote" class="notebody" epub:type="note">
                            <!-- table note -->
                            <html:p>* Carrot vs Potato study, 2014</html:p>
                        </html:aside>
                        <html:p>Observations were recorded. Conclusions were made.</html:p>
                    </html:section>
                </html:section>
            </html:body>
        </x:expect>
    </x:scenario>

    <x:scenario label="allowing inline images and custom alt attributes - issue 313">
        <x:context>
            <dtbook:div id="image-tests">
                <dtbook:div>
                    <!-- image in block context - with placeholder alt text: -->
                    <dtbook:img id="image-tests-img-1" src="valentin.jpg" alt="image"/>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in inline context - with placeholder alt text: -->
                    <dtbook:p>
                        <dtbook:img id="image-tests-img-2" src="valentin.jpg" alt="image"/>
                    </dtbook:p>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in figure - with placeholder alt text: -->
                    <dtbook:imggroup id="image-tests-figure-1">
                        <dtbook:img id="image-tests-img-3" src="valentin.jpg" alt="image"/>
                    </dtbook:imggroup>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in image series figure - with placeholder alt text: -->
                    <dtbook:imggroup id="image-tests-figure-2">
                        <dtbook:img id="image-tests-img-4" src="valentin.jpg" alt="image"/>
                        <dtbook:img id="image-tests-img-5" src="valentin.jpg" alt="image"/>
                    </dtbook:imggroup>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in block context - decorative: -->
                    <dtbook:img id="image-tests-img-6" src="valentin.jpg" alt=""/>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in inline context - decorative: -->
                    <dtbook:p>
                        <dtbook:img id="image-tests-img-7" src="valentin.jpg" alt=""/>
                    </dtbook:p>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in figure - decorative (should not be allowed/valid): -->
                    <dtbook:imggroup id="image-tests-figure-5">
                        <dtbook:img id="image-tests-img-8" src="valentin.jpg" alt=""/>
                    </dtbook:imggroup>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in image series figure - decorative (should not be allowed/valid): -->
                    <dtbook:imggroup id="image-tests-figure-6">
                        <dtbook:img id="image-tests-img-9" src="valentin.jpg" alt=""/>
                        <dtbook:img id="image-tests-img-10" src="valentin.jpg" alt=""/>
                    </dtbook:imggroup>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in block context - with custom alt text: -->
                    <dtbook:img id="image-tests-img-11" src="valentin.jpg" alt="中国文字"/>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in inline context - with custom alt text: -->
                    <dtbook:p>
                        <dtbook:img id="image-tests-img-12" src="valentin.jpg" alt="中国文字"/>
                    </dtbook:p>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in figure - with custom alt text: -->
                    <dtbook:imggroup id="image-tests-figure-8">
                        <dtbook:img id="image-tests-img-13" src="valentin.jpg" alt="中国文字"/>
                    </dtbook:imggroup>
                </dtbook:div>
                <dtbook:div>
                    <!-- image in image series figure - with custom alt text: -->
                    <dtbook:imggroup id="image-tests-figure-9">
                        <dtbook:img id="image-tests-img-14" src="valentin.jpg" alt="中国文字"/>
                        <dtbook:img id="image-tests-img-15" src="valentin.jpg" alt="中国文字"/>
                    </dtbook:imggroup>
                </dtbook:div>
            </dtbook:div>
        </x:context>
        <x:expect label="inline images and custom alt texts should be allowed">
            <html:div id="image-tests">
                <html:div>
                    <!-- image in block context - with placeholder alt text: -->
                    <html:img id="image-tests-img-1" src="images/valentin.jpg" alt="image"/>
                </html:div>
                <html:div>
                    <!-- image in inline context - with placeholder alt text: -->
                    <html:p>
                        <html:img id="image-tests-img-2" src="images/valentin.jpg" alt="image"/>
                    </html:p>
                </html:div>
                <html:div>
                    <!-- image in figure - with placeholder alt text: -->
                    <html:figure id="image-tests-figure-1" class="image">
                        <html:img id="image-tests-img-3" src="images/valentin.jpg" alt="image"/>
                    </html:figure>
                </html:div>
                <html:div>
                    <!-- image in image series figure - with placeholder alt text: -->
                    <html:figure id="image-tests-figure-2" class="image-series">
                        <html:figure class="image">
                            <html:img id="image-tests-img-4" src="images/valentin.jpg" alt="image"/>
                        </html:figure>
                        <html:figure class="image">
                            <html:img id="image-tests-img-5" src="images/valentin.jpg" alt="image"/>
                        </html:figure>
                    </html:figure>
                </html:div>
                <html:div>
                    <!-- image in block context - decorative: -->
                    <html:img id="image-tests-img-6" src="images/valentin.jpg" alt=""/>
                </html:div>
                <html:div>
                    <!-- image in inline context - decorative: -->
                    <html:p>
                        <html:img id="image-tests-img-7" src="images/valentin.jpg" alt=""/>
                    </html:p>
                </html:div>
                <html:div>
                    <!-- image in figure - decorative (should not be allowed/valid): -->
                    <html:figure id="image-tests-figure-5" class="image">
                        <html:img id="image-tests-img-8" src="images/valentin.jpg" alt=""/>
                    </html:figure>
                </html:div>
                <html:div>
                    <!-- image in image series figure - decorative (should not be allowed/valid): -->
                    <html:figure id="image-tests-figure-6" class="image-series">
                        <html:figure class="image">
                            <html:img id="image-tests-img-9" src="images/valentin.jpg" alt=""/>
                        </html:figure>
                        <html:figure class="image">
                            <html:img id="image-tests-img-10" src="images/valentin.jpg" alt=""/>
                        </html:figure>
                    </html:figure>
                </html:div>
                <html:div>
                    <!-- image in block context - with custom alt text: -->
                    <html:img id="image-tests-img-11" src="images/valentin.jpg" alt="中国文字"/>
                </html:div>
                <html:div>
                    <!-- image in inline context - with custom alt text: -->
                    <html:p>
                        <html:img id="image-tests-img-12" src="images/valentin.jpg" alt="中国文字"/>
                    </html:p>
                </html:div>
                <html:div>
                    <!-- image in figure - with custom alt text: -->
                    <html:figure id="image-tests-figure-8" class="image">
                        <html:img id="image-tests-img-13" src="images/valentin.jpg" alt="中国文字"/>
                    </html:figure>
                </html:div>
                <html:div>
                    <!-- image in image series figure - with custom alt text: -->
                    <html:figure id="image-tests-figure-9" class="image-series">
                        <html:figure class="image">
                            <html:img id="image-tests-img-14" src="images/valentin.jpg" alt="中国文字"/>
                        </html:figure>
                        <html:figure class="image">
                            <html:img id="image-tests-img-15" src="images/valentin.jpg" alt="中国文字"/>
                        </html:figure>
                    </html:figure>
                </html:div>
            </html:div>
        </x:expect>
    </x:scenario>
    
    <x:scenario label="insert empty dd at the end of dl if dt is last element">
        <x:context>
            <dtbook:dl>
                <dtbook:dt>dt</dtbook:dt>
            </dtbook:dl>
        </x:context>
        <x:expect label="inserting a dd will avoid epubcheck error RSC-005">
            <html:dl id="...">
                <html:dt id="...">dt</html:dt>
                <html:dd/>
            </html:dl>
        </x:expect>
    </x:scenario>

</x:description>
