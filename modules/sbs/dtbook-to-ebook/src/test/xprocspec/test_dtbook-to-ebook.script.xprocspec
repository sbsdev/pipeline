<?xml version="1.0" encoding="UTF-8"?>
<x:description
    xmlns:x="http://www.daisy.org/ns/xprocspec"
    xmlns:sbs="http://www.sbs.ch/pipeline"
    xmlns:c="http://www.w3.org/ns/xproc-step"
    xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns:epub="http://www.idpf.org/2007/ops"
    xmlns:d="http://www.daisy.org/ns/pipeline/data"
    script="http://www.daisy.org/pipeline/modules/modules/sbs/dtbook-to-ebook/dtbook-to-ebook.xpl">
  
  <x:scenario label="basic">
    <x:call step="sbs:dtbook-to-ebook">
      <x:input port="source">
	<x:document type="inline">
	  <dtbook xml:lang="de" xmlns="http://www.daisy.org/z3986/2005/dtbook/">
	    <head>
	      <meta name="dtb:uid" content="basic"/>
	    </head>
	    <book>
	      <bodymatter>
		<level1>
		  <list type="ol">
		    <li>Bla bla bla bla</li>
		    <li>Bla bla bla bla</li>
		    <li>Bla bla bla bla</li>
		    <li>Bla bla bla bla</li>
		    <li>Bla bla bla bla</li>
		  </list>
		</level1>
	      </bodymatter>
	    </book>
	  </dtbook>
	</x:document>
      </x:input>
      <x:option name="output-dir" select="concat($temp-dir,'basic/')"/>
    </x:call>
    <x:context label="The status">
      <x:document type="port" port="validation-status"/>
    </x:context>
    <x:expect label="The job should succeed" type="compare">
      <x:document type="inline">
	<d:validation-status result="ok"/>
      </x:document>
    </x:expect>
    <x:context label="The EPUB content">
      <x:document type="zip" base-uri="temp-dir" href="basic/basic.epub" ordered="true"/>
    </x:context>
    <x:expect label="The EPUB content" type="compare">
      <x:document type="inline">
	<c:zipfile name="basic.epub">
	  <c:file name="EPUB/basic-1-chapter.xhtml"/>
	  <!-- <c:file name="EPUB/basic-1-chapter_braille.css"/> -->
	  <!-- <c:file name="EPUB/basic-1-chapter_braille.xhtml"/> -->
	  <c:file name="EPUB/css/accessibility.css"/>
	  <c:file name="EPUB/nav.ncx"/>
	  <c:file name="EPUB/nav.xhtml"/>
	  <!-- <c:file name="EPUB/nav_braille.css"/> -->
	  <!-- <c:file name="EPUB/nav_braille.xhtml"/> -->
	  <!-- <c:file name="EPUB/package-braille.opf"/> -->
	  <c:file name="EPUB/package.opf"/>
	  <!-- <c:file name="EPUB/renditionMapping.html"/> -->
	  <c:file name="META-INF/container.xml"/>
	  <!-- <c:file name="META-INF/metadata.xml"/> -->
	  <c:file name="mimetype"/>
	</c:zipfile>
      </x:document>
    </x:expect>
    <x:context label="The XHTML document">
      <x:document type="file" base-uri="temp-dir" href="basic/basic.epub!/EPUB/basic-1-chapter.xhtml" select="//html:body"/>
    </x:context>
    <x:expect label="The XHTML document" type="compare">
      <x:document type="inline">
	<body xmlns="http://www.w3.org/1999/xhtml" id="level1_1" epub:type="bodymatter chapter">
	  <h1 id="h1_1">1 Im Original ohne Nummerierung</h1>
	  <ol id="list_1" class="list-style-type-none">
	    <li id="li_1">Bla bla bla bla</li>
	    <li id="li_2">Bla bla bla bla</li>
	    <li id="li_3">Bla bla bla bla</li>
	    <li id="li_4">Bla bla bla bla</li>
	    <li id="li_5">Bla bla bla bla</li>
	  </ol>
	</body>
      </x:document>
    </x:expect>

    <x:context label="The XHTML document">
      <x:document type="file" base-uri="temp-dir" href="basic/basic.epub!/EPUB/basic-1-chapter.xhtml" select="//html:html/html:head/html:link"/>
    </x:context>
    <x:expect label="The css link" type="compare">
      <x:document type="inline">
	<link xmlns="http://www.w3.org/1999/xhtml"
	      rel="stylesheet" type="text/css" href="css/accessibility.css"/>
      </x:document>
    </x:expect>

  </x:scenario>
  
</x:description>
